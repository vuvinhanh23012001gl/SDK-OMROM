
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>サンプルプログラム &#8212; StApi Python 1.2.2 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="StApi Python(stapipy)リファレンス" href="reference.html" />
    <link rel="prev" title="プログラマーズガイド" href="programmersguide.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="reference.html" title="StApi Python(stapipy)リファレンス"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="programmersguide.html" title="プログラマーズガイド"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">StApi Python 1.2.2 ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">サンプルプログラム</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sample-programs">
<h1>サンプルプログラム<a class="headerlink" href="#sample-programs" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="list-of-samples">
<h2>サンプル一覧<a class="headerlink" href="#list-of-samples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 68%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ファイル名</p></th>
<th class="head"><p>機能</p></th>
<th class="head"><p>画像取得</p></th>
<th class="head"><p>コールバック</p></th>
<th class="head"><p>サードパーティー</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#auto-functions-opencv-py"><span class="std std-ref">auto_functions_opencv.py</span></a></p></td>
<td><p>AWB, AGC, AE</p></td>
<td><p>Yes</p></td>
<td><p>StApi(クラス)</p></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#camera-side-roi-py"><span class="std std-ref">camera_side_roi.py</span></a></p></td>
<td><p>カメラ側ROI</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#event-device-lost-py"><span class="std std-ref">event_device_lost.py</span></a></p></td>
<td><p>デバイスロスト検出</p></td>
<td><p>Yes</p></td>
<td><p>GenApi(関数)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#featurelist-py"><span class="std std-ref">featurelist.py</span></a></p></td>
<td><p>ノードマップのアクセス</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#framestart-trigger-py"><span class="std std-ref">framestart_trigger.py</span></a></p></td>
<td><p>トリガー</p></td>
<td><p>Yes</p></td>
<td><p>StApi(関数)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#gige-action-command-py"><span class="std std-ref">gige_action_command.py</span></a></p></td>
<td><p>GigEVision ActionCommand</p></td>
<td><p>Yes</p></td>
<td><p>StApi(関数), GenApi(クラス)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#gige-configurations-py"><span class="std std-ref">gige_configurations.py</span></a></p></td>
<td><p>GigEVision設定</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#gige-multicast-py"><span class="std std-ref">gige_multicast.py</span></a></p></td>
<td><p>GigEVision Multicast</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#grab-callback-class-py"><span class="std std-ref">grab_callback_class.py</span></a></p></td>
<td><p>コールバックで取得</p></td>
<td><p>Yes</p></td>
<td><p>StApi(クラス)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#grab-callback-opencv-py"><span class="std std-ref">grab_callback_opencv.py</span></a></p></td>
<td><p>コールバックで取得、表示</p></td>
<td><p>Yes</p></td>
<td><p>StApi(クラス)</p></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#grab-callback-py"><span class="std std-ref">grab_callback.py</span></a></p></td>
<td><p>コールバックで取得</p></td>
<td><p>Yes</p></td>
<td><p>StApi(関数)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#grab-camera-event-py"><span class="std std-ref">grab_camera_event.py</span></a></p></td>
<td><p>カメライベント</p></td>
<td><p>Yes</p></td>
<td><p>GenApi(関数)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#grab-chunk-image-py"><span class="std std-ref">grab_chunk_image.py</span></a></p></td>
<td><p>チャンク</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#grab-ip-opencv-py"><span class="std std-ref">grab_ip_opencv.py</span></a></p></td>
<td><p>シンプル取得、StApi画像処理で画像変換、OpenCVで表示</p></td>
<td><p>Yes</p></td>
<td></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#grab-opencv-py"><span class="std std-ref">grab_opencv.py</span></a></p></td>
<td><p>シンプル取得、OpenCVで画像変換と表示</p></td>
<td><p>Yes</p></td>
<td></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#grab-py"><span class="std std-ref">grab.py</span></a></p></td>
<td><p>シンプル取得</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#host-side-roi-opencv-py"><span class="std std-ref">host_side_roi_opencv.py</span></a></p></td>
<td><p>Host側ROI</p></td>
<td><p>Yes</p></td>
<td></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#multiple-cameras-py"><span class="std std-ref">multiple_cameras.py</span></a></p></td>
<td><p>マルチカメラ</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#multiple-systems-py"><span class="std std-ref">multiple_systems.py</span></a></p></td>
<td><p>マルチシステム</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#save-and-load-image-py"><span class="std std-ref">save_and_load_image.py</span></a></p></td>
<td><p>画像ファイルの保存と読み取り</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#save-load-features-py"><span class="std std-ref">save_load_features.py</span></a></p></td>
<td><p>設定ファイル</p></td>
<td><p>No</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#save-video-py"><span class="std std-ref">save_video.py</span></a></p></td>
<td><p>動画の保存</p></td>
<td><p>Yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#singleconverter-opencv-py"><span class="std std-ref">singleconverter_opencv.py</span></a></p></td>
<td><p>StApi IPで画像変換</p></td>
<td><p>Yes</p></td>
<td></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#singlefilter-opencv-py"><span class="std std-ref">singlefilter_opencv.py</span></a></p></td>
<td><p>StApi IPで画像フィルター</p></td>
<td><p>Yes</p></td>
<td></td>
<td><p>numpy, opencv-python</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#user-memory-py"><span class="std std-ref">user_memory.py</span></a></p></td>
<td><p>ユーザーデータを保存できるメモリーを操作</p></td>
<td><p>No</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#user-set-ctrl-py"><span class="std std-ref">user_set_ctrl.py</span></a></p></td>
<td><p>User set, feature bag</p></td>
<td><p>No</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="source-codes">
<h2>ソースコード<a class="headerlink" href="#source-codes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<section id="auto-functions-opencv-py">
<h3>auto_functions_opencv.py<a class="headerlink" href="#auto-functions-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample demostrates how to set AWB, AGC, and AE function.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Register and use callback function with StApi</span>
<span class="linenos">  7</span><span class="sd"> - Acquire image via callback function</span>
<span class="linenos">  8</span><span class="sd"> - Set AWB, AGC, AE</span>
<span class="linenos">  9</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> - Convert Bayer image format to RGB using OpenCV</span>
<span class="linenos"> 11</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 12</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 13</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 14</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 15</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 18</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="linenos"> 19</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 20</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 23</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="c1"># Feature names</span>
<span class="linenos"> 26</span><span class="n">EXPOSURE_AUTO</span> <span class="o">=</span> <span class="s2">&quot;ExposureAuto&quot;</span>
<span class="linenos"> 27</span><span class="n">GAIN_AUTO</span> <span class="o">=</span> <span class="s2">&quot;GainAuto&quot;</span>
<span class="linenos"> 28</span><span class="n">BALANCE_WHITE_AUTO</span> <span class="o">=</span> <span class="s2">&quot;BalanceWhiteAuto&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="n">AUTO_LIGHT_TARGET</span> <span class="o">=</span> <span class="s2">&quot;AutoLightTarget&quot;</span>
<span class="linenos"> 31</span><span class="n">GAIN</span> <span class="o">=</span> <span class="s2">&quot;Gain&quot;</span>
<span class="linenos"> 32</span><span class="n">GAIN_RAW</span> <span class="o">=</span> <span class="s2">&quot;GainRaw&quot;</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="n">EXPOSURE_MODE</span> <span class="o">=</span> <span class="s2">&quot;ExposureMode&quot;</span>
<span class="linenos"> 35</span><span class="n">EXPOSURE_TIME</span> <span class="o">=</span> <span class="s2">&quot;ExposureTime&quot;</span>
<span class="linenos"> 36</span><span class="n">EXPOSURE_TIME_RAW</span> <span class="o">=</span> <span class="s2">&quot;ExposureTimeRaw&quot;</span> <span class="c1"># Custom</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span><span class="n">BALANCE_RATIO_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;BalanceRatioSelector&quot;</span>
<span class="linenos"> 39</span><span class="n">BALANCE_RATIO</span> <span class="o">=</span> <span class="s2">&quot;BalanceRatio&quot;</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span><span class="k">class</span> <span class="nc">CMyCallback</span><span class="p">:</span>
<span class="linenos"> 43</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 44</span><span class="sd">    Class that contains a callback function.</span>
<span class="linenos"> 45</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 48</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 49</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="nd">@property</span>
<span class="linenos"> 52</span>    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 53</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Property: return PyIStImage of the grabbed image.&quot;&quot;&quot;</span>
<span class="linenos"> 54</span>        <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 55</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="linenos"> 56</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 57</span>            <span class="n">duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 58</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="linenos"> 59</span>        <span class="k">return</span> <span class="n">duplicate</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span>    <span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 62</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 63</span><span class="sd">        Callback to handle events from DataStream.</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span><span class="sd">        :param handle: handle that trigger the callback.</span>
<span class="linenos"> 66</span><span class="sd">        :param context: user data passed on during callback registration.</span>
<span class="linenos"> 67</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 68</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos"> 69</span>        <span class="k">if</span> <span class="n">st_datastream</span><span class="p">:</span>
<span class="linenos"> 70</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 71</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 72</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 73</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos"> 74</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>                    <span class="c1"># Check the pixelformat of the input image.</span>
<span class="linenos"> 77</span>                    <span class="n">pixel_format</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">pixel_format</span>
<span class="linenos"> 78</span>                    <span class="n">pixel_format_info</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">get_pixel_format_info</span><span class="p">(</span><span class="n">pixel_format</span><span class="p">)</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>                    <span class="c1"># Only mono or bayer is processed.</span>
<span class="linenos"> 81</span>                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_mono</span> <span class="ow">or</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">):</span>
<span class="linenos"> 82</span>                        <span class="k">return</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>                    <span class="c1"># Get raw image data.</span>
<span class="linenos"> 85</span>                    <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>                    <span class="c1"># Perform pixel value scaling if each pixel component is</span>
<span class="linenos"> 88</span>                    <span class="c1"># larger than 8bit. Example: 10bit Bayer/Mono, 12bit, etc.</span>
<span class="linenos"> 89</span>                    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">each_component_total_bit_count</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
<span class="linenos"> 90</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<span class="linenos"> 91</span>                        <span class="n">division</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pixel_format_info</span>
<span class="linenos"> 92</span>                                       <span class="o">.</span><span class="n">each_component_valid_bit_count</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
<span class="linenos"> 93</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="p">(</span><span class="n">nparr</span> <span class="o">/</span> <span class="n">division</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
<span class="linenos"> 94</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 95</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span>                    <span class="c1"># Process image for display.</span>
<span class="linenos"> 98</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>                    <span class="c1"># Perform color conversion for Bayer.</span>
<span class="linenos">101</span>                    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">:</span>
<span class="linenos">102</span>                        <span class="n">bayer_type</span> <span class="o">=</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">get_pixel_color_filter</span><span class="p">()</span>
<span class="linenos">103</span>                        <span class="k">if</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerRG</span><span class="p">:</span>
<span class="linenos">104</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_RG2RGB</span><span class="p">)</span>
<span class="linenos">105</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGR</span><span class="p">:</span>
<span class="linenos">106</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GR2RGB</span><span class="p">)</span>
<span class="linenos">107</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGB</span><span class="p">:</span>
<span class="linenos">108</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GB2RGB</span><span class="p">)</span>
<span class="linenos">109</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerBG</span><span class="p">:</span>
<span class="linenos">110</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_BG2RGB</span><span class="p">)</span>
<span class="linenos">111</span>
<span class="linenos">112</span>                    <span class="c1"># Resize image and store to self._image.</span>
<span class="linenos">113</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">114</span>                                       <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos">115</span>                                       <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos">116</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="linenos">117</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">nparr</span>
<span class="linenos">118</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="linenos">119</span>
<span class="linenos">120</span>
<span class="linenos">121</span><span class="k">def</span> <span class="nf">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">):</span>
<span class="linenos">122</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">123</span><span class="sd">    Display and allow user to modify the enumeration value.</span>
<span class="linenos">124</span>
<span class="linenos">125</span><span class="sd">    :param nodemap: node map.</span>
<span class="linenos">126</span><span class="sd">    :param enum_name: name of the enumeration node.</span>
<span class="linenos">127</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">128</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos">129</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos">130</span>        <span class="k">return</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="c1"># Cast to PyIEnumeration from PyNode</span>
<span class="linenos">133</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos">134</span>
<span class="linenos">135</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">136</span>        <span class="nb">print</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos">137</span>        <span class="n">enum_entries</span> <span class="o">=</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos">138</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">)):</span>
<span class="linenos">139</span>            <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos">140</span>            <span class="k">if</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos">141</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
<span class="linenos">142</span>                      <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_entry</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">,</span>
<span class="linenos">143</span>                      <span class="s2">&quot;(Current)&quot;</span> <span class="k">if</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">144</span>                                             <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">145</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select : &quot;</span><span class="p">))</span>
<span class="linenos">146</span>        <span class="k">if</span> <span class="n">selection</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">):</span>
<span class="linenos">147</span>            <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
<span class="linenos">148</span>            <span class="n">enum_node</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos">149</span>            <span class="k">break</span>
<span class="linenos">150</span>
<span class="linenos">151</span>
<span class="linenos">152</span><span class="k">def</span> <span class="nf">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
<span class="linenos">153</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">154</span><span class="sd">    Edit setting which has numeric type.</span>
<span class="linenos">155</span>
<span class="linenos">156</span><span class="sd">    :param nodemap:  Node map.</span>
<span class="linenos">157</span><span class="sd">    :param node_name: Node name.</span>
<span class="linenos">158</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">159</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
<span class="linenos">160</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos">161</span>        <span class="k">return</span>
<span class="linenos">162</span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IFloat</span><span class="p">:</span>
<span class="linenos">163</span>        <span class="n">node_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIFloat</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos">164</span>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IInteger</span><span class="p">:</span>
<span class="linenos">165</span>        <span class="n">node_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIInteger</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos">166</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">167</span>        <span class="nb">print</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
<span class="linenos">168</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Min=</span><span class="si">{0}</span><span class="s2"> Max=</span><span class="si">{1}</span><span class="s2"> Current=</span><span class="si">{2}{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">169</span>              <span class="n">node_value</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">node_value</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">node_value</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos">170</span>              <span class="s2">&quot; Inc=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_value</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="k">if</span>\
<span class="linenos">171</span>                    <span class="n">node_value</span><span class="o">.</span><span class="n">inc_mode</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCIncMode</span><span class="o">.</span><span class="n">FixedIncrement</span>\
<span class="linenos">172</span>                    <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">173</span>        <span class="n">new_value</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;New value : &quot;</span><span class="p">)</span>
<span class="linenos">174</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos">175</span>        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IFloat</span><span class="p">:</span>
<span class="linenos">176</span>            <span class="n">new_numeric_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
<span class="linenos">177</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">178</span>            <span class="n">new_numeric_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
<span class="linenos">179</span>        <span class="k">if</span> <span class="n">node_value</span><span class="o">.</span><span class="n">min</span> <span class="o">&lt;=</span> <span class="n">new_numeric_value</span> <span class="o">&lt;=</span> <span class="n">node_value</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
<span class="linenos">180</span>            <span class="n">node_value</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_numeric_value</span>
<span class="linenos">181</span>            <span class="k">return</span>
<span class="linenos">182</span>
<span class="linenos">183</span>
<span class="linenos">184</span><span class="k">def</span> <span class="nf">edit_enum_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">,</span> <span class="n">numeric_name</span><span class="p">):</span>
<span class="linenos">185</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">186</span><span class="sd">    Display the contents of the current enumeration node and edit settings.</span>
<span class="linenos">187</span>
<span class="linenos">188</span><span class="sd">    :param nodemap: Node map.</span>
<span class="linenos">189</span><span class="sd">    :param enum_name: Enumeration name.</span>
<span class="linenos">190</span><span class="sd">    :param numeric_name: Numeric name.</span>
<span class="linenos">191</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">192</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos">193</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos">194</span>        <span class="k">return</span>
<span class="linenos">195</span>
<span class="linenos">196</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos">197</span>    <span class="n">enum_entries</span> <span class="o">=</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos">198</span>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">)):</span>
<span class="linenos">199</span>        <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos">200</span>        <span class="k">if</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos">201</span>            <span class="n">enum_node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">202</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">enum_name</span><span class="p">,</span>
<span class="linenos">203</span>                  <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_entry</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">))</span>
<span class="linenos">204</span>            <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">numeric_name</span><span class="p">)</span>
<span class="linenos">205</span>
<span class="linenos">206</span>
<span class="linenos">207</span><span class="k">def</span> <span class="nf">exposure_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos">208</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure exposure using the given nodemap.&quot;&quot;&quot;</span>
<span class="linenos">209</span>    <span class="c1"># Configure the ExposureMode</span>
<span class="linenos">210</span>    <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">EXPOSURE_MODE</span><span class="p">)</span>
<span class="linenos">211</span>
<span class="linenos">212</span>    <span class="c1"># Configure the ExposureAuto</span>
<span class="linenos">213</span>    <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">EXPOSURE_AUTO</span><span class="p">)</span>
<span class="linenos">214</span>
<span class="linenos">215</span>    <span class="c1"># Configure the AutoLightTarget</span>
<span class="linenos">216</span>    <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">AUTO_LIGHT_TARGET</span><span class="p">)</span>
<span class="linenos">217</span>
<span class="linenos">218</span>    <span class="k">if</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">EXPOSURE_TIME</span><span class="p">):</span>
<span class="linenos">219</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">EXPOSURE_TIME</span><span class="p">)</span>
<span class="linenos">220</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">221</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">EXPOSURE_TIME_RAW</span><span class="p">)</span>
<span class="linenos">222</span>
<span class="linenos">223</span>
<span class="linenos">224</span><span class="k">def</span> <span class="nf">gain_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos">225</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure gain using the given nodemap.&quot;&quot;&quot;</span>
<span class="linenos">226</span>    <span class="c1"># Configure the GainAuto</span>
<span class="linenos">227</span>    <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">GAIN_AUTO</span><span class="p">)</span>
<span class="linenos">228</span>
<span class="linenos">229</span>    <span class="c1"># Configure the AutoLightTarget</span>
<span class="linenos">230</span>    <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">AUTO_LIGHT_TARGET</span><span class="p">)</span>
<span class="linenos">231</span>
<span class="linenos">232</span>    <span class="k">if</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GAIN</span><span class="p">):</span>
<span class="linenos">233</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">GAIN</span><span class="p">)</span>
<span class="linenos">234</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">235</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">GAIN_RAW</span><span class="p">)</span>
<span class="linenos">236</span>
<span class="linenos">237</span>
<span class="linenos">238</span><span class="k">def</span> <span class="nf">balance_white_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos">239</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure balance ratio/white using the given nodemap.&quot;&quot;&quot;</span>
<span class="linenos">240</span>    <span class="c1"># Configure the BalanceWhiteAuto</span>
<span class="linenos">241</span>    <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">BALANCE_WHITE_AUTO</span><span class="p">)</span>
<span class="linenos">242</span>
<span class="linenos">243</span>    <span class="c1"># While switching the BalanceRatioSelector, configure the BalanceRatio</span>
<span class="linenos">244</span>    <span class="n">edit_enum_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">BALANCE_RATIO_SELECTOR</span><span class="p">,</span> <span class="n">BALANCE_RATIO</span><span class="p">)</span>
<span class="linenos">245</span>
<span class="linenos">246</span>
<span class="linenos">247</span><span class="k">def</span> <span class="nf">do_auto_functions</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos">248</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Function running in a separate thread for auto function configuration.&quot;&quot;&quot;</span>
<span class="linenos">249</span>    <span class="c1"># Check if features available.</span>
<span class="linenos">250</span>    <span class="n">feature_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EXPOSURE_AUTO</span><span class="p">,</span> <span class="n">GAIN_AUTO</span><span class="p">,</span> <span class="n">BALANCE_WHITE_AUTO</span><span class="p">]</span>
<span class="linenos">251</span>    <span class="n">is_writable_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="linenos">252</span>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">feature_list</span><span class="p">):</span>
<span class="linenos">253</span>        <span class="k">with</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="k">as</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos">254</span>            <span class="n">is_writable_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span> <span class="k">else</span> <span class="kc">False</span>
<span class="linenos">255</span>
<span class="linenos">256</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">257</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos">258</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Auto Functions&quot;</span><span class="p">)</span>
<span class="linenos">259</span>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">feature_list</span><span class="p">):</span>
<span class="linenos">260</span>            <span class="k">if</span> <span class="n">is_writable_list</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
<span class="linenos">261</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">feature</span><span class="p">))</span>
<span class="linenos">262</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Else : Exit&quot;</span><span class="p">)</span>
<span class="linenos">263</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select : &quot;</span><span class="p">))</span>
<span class="linenos">264</span>        <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_writable_list</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">265</span>            <span class="n">exposure_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">266</span>        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">is_writable_list</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">267</span>            <span class="n">gain_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">268</span>        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">is_writable_list</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">269</span>            <span class="n">balance_white_auto</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">270</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">271</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Focus on the OpenCV window and press any key to terminate.&quot;</span><span class="p">)</span>
<span class="linenos">272</span>            <span class="k">break</span>
<span class="linenos">273</span>
<span class="linenos">274</span>
<span class="linenos">275</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">276</span>    <span class="n">my_callback</span> <span class="o">=</span> <span class="n">CMyCallback</span><span class="p">()</span>
<span class="linenos">277</span>    <span class="n">cb_func</span> <span class="o">=</span> <span class="n">my_callback</span><span class="o">.</span><span class="n">datastream_callback</span>
<span class="linenos">278</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">279</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">280</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">281</span>
<span class="linenos">282</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">283</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">284</span>
<span class="linenos">285</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">286</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">287</span>
<span class="linenos">288</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">289</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">290</span>
<span class="linenos">291</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">292</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">293</span>
<span class="linenos">294</span>        <span class="c1"># Register callback for datastream</span>
<span class="linenos">295</span>        <span class="n">callback</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">cb_func</span><span class="p">)</span>
<span class="linenos">296</span>
<span class="linenos">297</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">298</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">299</span>
<span class="linenos">300</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">301</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">302</span>
<span class="linenos">303</span>        <span class="c1"># Get device nodemap to access the device settings.</span>
<span class="linenos">304</span>        <span class="n">remote_nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">305</span>
<span class="linenos">306</span>        <span class="c1"># Create and start a thread for auto function configuration.</span>
<span class="linenos">307</span>        <span class="n">autofunc_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">do_auto_functions</span><span class="p">,</span>
<span class="linenos">308</span>                                           <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">remote_nodemap</span><span class="p">,))</span>
<span class="linenos">309</span>        <span class="n">autofunc_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="linenos">310</span>
<span class="linenos">311</span>        <span class="c1"># Display image using OpenCV.</span>
<span class="linenos">312</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">313</span>            <span class="n">output_image</span> <span class="o">=</span> <span class="n">my_callback</span><span class="o">.</span><span class="n">image</span>
<span class="linenos">314</span>            <span class="k">if</span> <span class="n">output_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">315</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">output_image</span><span class="p">)</span>
<span class="linenos">316</span>            <span class="n">key_input</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">317</span>            <span class="k">if</span> <span class="n">key_input</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">318</span>                <span class="k">break</span>
<span class="linenos">319</span>
<span class="linenos">320</span>        <span class="n">autofunc_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="linenos">321</span>
<span class="linenos">322</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">323</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">324</span>
<span class="linenos">325</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">326</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">327</span>
<span class="linenos">328</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">329</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="camera-side-roi-py">
<h3>camera_side_roi.py<a class="headerlink" href="#camera-side-roi-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to set ROI in camera side and handle the image data.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Set image ROI parameter</span>
<span class="linenos">  7</span><span class="sd"> - Acquire image data</span>
<span class="linenos">  8</span><span class="sd"> - Process the acquired ROI images</span>
<span class="linenos">  9</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 14</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="c1"># Feature names</span>
<span class="linenos"> 17</span><span class="n">PIXEL_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;PixelFormat&quot;</span>
<span class="linenos"> 18</span><span class="n">REGION_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;RegionSelector&quot;</span>
<span class="linenos"> 19</span><span class="n">REGION_MODE</span> <span class="o">=</span> <span class="s2">&quot;RegionMode&quot;</span>
<span class="linenos"> 20</span><span class="n">OFFSET_X</span> <span class="o">=</span> <span class="s2">&quot;OffsetX&quot;</span>
<span class="linenos"> 21</span><span class="n">OFFSET_Y</span> <span class="o">=</span> <span class="s2">&quot;OffsetY&quot;</span>
<span class="linenos"> 22</span><span class="n">WIDTH</span> <span class="o">=</span> <span class="s2">&quot;Width&quot;</span>
<span class="linenos"> 23</span><span class="n">HEIGHT</span> <span class="o">=</span> <span class="s2">&quot;Height&quot;</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="k">def</span> <span class="nf">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 27</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 28</span><span class="sd">    Display and edit enumeration value.</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="sd">    :param nodemap: Node map.</span>
<span class="linenos"> 31</span><span class="sd">    :param enum_name: Enumeration name.</span>
<span class="linenos"> 32</span><span class="sd">    :return: True if enumeration value is updated. False otherwise.</span>
<span class="linenos"> 33</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 34</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos"> 35</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 36</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos"> 37</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 38</span>    <span class="n">enum_entries</span> <span class="o">=</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos"> 39</span>    <span class="nb">print</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos"> 40</span>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">)):</span>
<span class="linenos"> 41</span>        <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos"> 42</span>        <span class="k">if</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 43</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
<span class="linenos"> 44</span>                  <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_entry</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">,</span>
<span class="linenos"> 45</span>                  <span class="s2">&quot;(Current)&quot;</span> <span class="k">if</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 46</span>                                         <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos"> 47</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Else : Exit&quot;</span><span class="p">)</span>
<span class="linenos"> 48</span>    <span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select : &quot;</span><span class="p">))</span>
<span class="linenos"> 49</span>    <span class="k">if</span> <span class="n">selection</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">)</span> <span class="ow">and</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 50</span>        <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
<span class="linenos"> 51</span>        <span class="n">enum_node</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos"> 52</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span><span class="k">def</span> <span class="nf">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
<span class="linenos"> 56</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 57</span><span class="sd">    Edit setting which has numeric type.</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="sd">    :param nodemap:  Node map.</span>
<span class="linenos"> 60</span><span class="sd">    :param node_name: Node name.</span>
<span class="linenos"> 61</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 62</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
<span class="linenos"> 63</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 64</span>        <span class="k">return</span>
<span class="linenos"> 65</span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IFloat</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">node_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIFloat</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 67</span>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IInteger</span><span class="p">:</span>
<span class="linenos"> 68</span>        <span class="n">node_value</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIInteger</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 69</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 70</span>        <span class="nb">print</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
<span class="linenos"> 71</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Min=</span><span class="si">{0}</span><span class="s2"> Max=</span><span class="si">{1}</span><span class="s2"> Current=</span><span class="si">{2}{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 72</span>              <span class="n">node_value</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">node_value</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">node_value</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos"> 73</span>              <span class="s2">&quot; Inc=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_value</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="k">if</span>\
<span class="linenos"> 74</span>                    <span class="n">node_value</span><span class="o">.</span><span class="n">inc_mode</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCIncMode</span><span class="o">.</span><span class="n">FixedIncrement</span>\
<span class="linenos"> 75</span>                    <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos"> 76</span>        <span class="n">new_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;New value : &quot;</span><span class="p">))</span>
<span class="linenos"> 77</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos"> 78</span>        <span class="k">if</span> <span class="n">node_value</span><span class="o">.</span><span class="n">min</span> <span class="o">&lt;=</span> <span class="n">new_value</span> <span class="o">&lt;=</span> <span class="n">node_value</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
<span class="linenos"> 79</span>            <span class="n">node_value</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_value</span>
<span class="linenos"> 80</span>            <span class="k">return</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="k">def</span> <span class="nf">set_camera_side_roi</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 85</span><span class="sd">    Set camera side ROI.</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="sd">    :param nodemap: Node map.</span>
<span class="linenos"> 88</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 89</span>    <span class="n">region_selector</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">REGION_SELECTOR</span><span class="p">)</span>
<span class="linenos"> 90</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">region_selector</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="c1"># Single ROI:</span>
<span class="linenos"> 92</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">OFFSET_X</span><span class="p">)</span>
<span class="linenos"> 93</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">)</span>
<span class="linenos"> 94</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">OFFSET_Y</span><span class="p">)</span>
<span class="linenos"> 95</span>        <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>
<span class="linenos"> 96</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 97</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 98</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">REGION_SELECTOR</span><span class="p">):</span>
<span class="linenos"> 99</span>                <span class="k">return</span>
<span class="linenos">100</span>
<span class="linenos">101</span>            <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">REGION_MODE</span><span class="p">)</span>
<span class="linenos">102</span>            <span class="n">region_mode</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">REGION_MODE</span><span class="p">))</span>
<span class="linenos">103</span>            <span class="k">if</span> <span class="n">region_mode</span><span class="o">.</span><span class="n">current_entry</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">region_mode</span><span class="p">[</span><span class="s2">&quot;Off&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<span class="linenos">104</span>                <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">OFFSET_X</span><span class="p">)</span>
<span class="linenos">105</span>                <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">)</span>
<span class="linenos">106</span>                <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">OFFSET_Y</span><span class="p">)</span>
<span class="linenos">107</span>                <span class="n">edit_setting</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>
<span class="linenos">108</span>
<span class="linenos">109</span>
<span class="linenos">110</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">111</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">112</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">113</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">114</span>
<span class="linenos">115</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">116</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">117</span>
<span class="linenos">118</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">119</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">120</span>
<span class="linenos">121</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">122</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">125</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">126</span>
<span class="linenos">127</span>        <span class="c1"># Get INodeMap object to access the setting of the device.</span>
<span class="linenos">128</span>        <span class="n">remote_nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">129</span>
<span class="linenos">130</span>        <span class="c1"># Check and set PixelFormat</span>
<span class="linenos">131</span>        <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">remote_nodemap</span><span class="p">,</span> <span class="n">PIXEL_FORMAT</span><span class="p">)</span>
<span class="linenos">132</span>
<span class="linenos">133</span>        <span class="c1"># Check and set CameraSideROI</span>
<span class="linenos">134</span>        <span class="n">set_camera_side_roi</span><span class="p">(</span><span class="n">remote_nodemap</span><span class="p">)</span>
<span class="linenos">135</span>
<span class="linenos">136</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">137</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">138</span>
<span class="linenos">139</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">140</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">141</span>
<span class="linenos">142</span>        <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">143</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">144</span>            <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">145</span>            <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos">146</span>            <span class="c1"># assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos">147</span>            <span class="c1"># properly.</span>
<span class="linenos">148</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">149</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">150</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">151</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">152</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">153</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">154</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">155</span>                          <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">156</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">157</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">158</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">159</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">160</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">161</span>
<span class="linenos">162</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">163</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">164</span>
<span class="linenos">165</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">166</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">167</span>
<span class="linenos">168</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">169</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="event-device-lost-py">
<h3>event_device_lost.py<a class="headerlink" href="#event-device-lost-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to setup and detect device connection lost.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Detect the disconnection of camera</span>
<span class="linenos">  7</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="c1"># Import stapipy package</span>
<span class="linenos"> 10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="n">EVENT_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;EventSelector&quot;</span>
<span class="linenos"> 13</span><span class="n">EVENT_NOTIFICATION</span> <span class="o">=</span> <span class="s2">&quot;EventNotification&quot;</span>
<span class="linenos"> 14</span><span class="n">EVENT_NOTIFICATION_ON</span> <span class="o">=</span> <span class="s2">&quot;On&quot;</span>
<span class="linenos"> 15</span><span class="n">TARGET_EVENT_NAME</span> <span class="o">=</span> <span class="s2">&quot;DeviceLost&quot;</span>
<span class="linenos"> 16</span><span class="n">CALLBACK_NODE_NAME</span> <span class="o">=</span> <span class="s2">&quot;EventDeviceLost&quot;</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="k">def</span> <span class="nf">node_callback</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">st_device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 19</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 20</span><span class="sd">    Callback to handle events from GenICam node.</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="sd">    :param node: node that triggered the callback.</span>
<span class="linenos"> 23</span><span class="sd">    :param st_device: PyStDevice object passed on at callback registration.</span>
<span class="linenos"> 24</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 25</span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 26</span>        <span class="k">if</span> <span class="n">st_device</span><span class="o">.</span><span class="n">is_device_lost</span><span class="p">:</span>
<span class="linenos"> 27</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OnNodeEvent: </span><span class="si">{0}</span><span class="s2">: DeviceLost&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">display_name</span><span class="p">))</span>
<span class="linenos"> 28</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 29</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OnNodeEvent: </span><span class="si">{0}</span><span class="s2">: Invalidated&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">display_name</span><span class="p">))</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="k">def</span> <span class="nf">do_grabbing</span><span class="p">(</span><span class="n">st_device</span><span class="p">):</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform grabbing using the given st_device. &quot;&quot;&quot;</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 36</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>    <span class="c1"># Get host side device setting (nodemap)</span>
<span class="linenos"> 39</span>    <span class="n">st_nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">local_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>    <span class="c1"># Get EventDeviceLost node</span>
<span class="linenos"> 42</span>    <span class="n">st_event_node</span> <span class="o">=</span> <span class="n">st_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">CALLBACK_NODE_NAME</span><span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>    <span class="c1"># Register callback for EventDeviceLost</span>
<span class="linenos"> 45</span>    <span class="c1"># To ensure the device lost flag is already updated when fired, here we</span>
<span class="linenos"> 46</span>    <span class="c1"># use OutsideLock flag (executed on leaving outside the lock-guarded</span>
<span class="linenos"> 47</span>    <span class="c1"># GenApi node.</span>
<span class="linenos"> 48</span>    <span class="n">st_event_node</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">node_callback</span><span class="p">,</span> <span class="n">st_device</span><span class="p">,</span>
<span class="linenos"> 49</span>                                    <span class="n">st</span><span class="o">.</span><span class="n">EGCCallbackType</span><span class="o">.</span><span class="n">OutsideLock</span><span class="p">)</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="c1"># Enable the transmission of the target event</span>
<span class="linenos"> 52</span>    <span class="n">st_event_selector</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">st_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">EVENT_SELECTOR</span><span class="p">))</span>
<span class="linenos"> 53</span>    <span class="n">st_event_selector</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">TARGET_EVENT_NAME</span><span class="p">)</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="n">st_event_notification</span> <span class="o">=</span> \
<span class="linenos"> 56</span>        <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">st_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">EVENT_NOTIFICATION</span><span class="p">))</span>
<span class="linenos"> 57</span>    <span class="n">st_event_notification</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">EVENT_NOTIFICATION_ON</span><span class="p">)</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>    <span class="c1"># Start event handling thread</span>
<span class="linenos"> 60</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">start_event_acquisition</span><span class="p">()</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 63</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 66</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 69</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos"> 72</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 73</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos"> 74</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos"> 75</span>        <span class="c1">#          cleared to None to allow Garbage Collector release the buffer</span>
<span class="linenos"> 76</span>        <span class="c1">#          properly.</span>
<span class="linenos"> 77</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 78</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 79</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 80</span>                <span class="c1"># Create an image object.</span>
<span class="linenos"> 81</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 82</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 83</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2"> &quot;</span>
<span class="linenos"> 84</span>                      <span class="s2">&quot;(Unplug the camera to trigger device lost).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 85</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 86</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 87</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 88</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 89</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos"> 90</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos"> 93</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos"> 96</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="c1"># Stop event acquisition thread</span>
<span class="linenos"> 99</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">stop_event_acquisition</span><span class="p">()</span>
<span class="linenos">100</span>
<span class="linenos">101</span>
<span class="linenos">102</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">103</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">104</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">105</span>
<span class="linenos">106</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">107</span>    <span class="c1"># If StApi has not been initialized, StApi will automatically initialize</span>
<span class="linenos">108</span>    <span class="c1"># itself.</span>
<span class="linenos">109</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">110</span>
<span class="linenos">111</span>    <span class="n">device_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">112</span>
<span class="linenos">113</span>    <span class="n">repeat</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">114</span>    <span class="k">while</span> <span class="n">repeat</span><span class="p">:</span>
<span class="linenos">115</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">116</span>        <span class="k">if</span> <span class="n">device_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">117</span>            <span class="c1"># Connect to first detected device.</span>
<span class="linenos">118</span>            <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">119</span>
<span class="linenos">120</span>            <span class="c1"># Hold the device ID for re-open</span>
<span class="linenos">121</span>            <span class="n">device_id</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">device_id</span>
<span class="linenos">122</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">123</span>            <span class="c1"># Get the number of interfaces</span>
<span class="linenos">124</span>            <span class="n">interface_count</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">interface_count</span>
<span class="linenos">125</span>            <span class="k">for</span> <span class="n">interface_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interface_count</span><span class="p">):</span>
<span class="linenos">126</span>                <span class="n">st_interface</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(</span><span class="n">interface_index</span><span class="p">)</span>
<span class="linenos">127</span>                <span class="k">try</span><span class="p">:</span>
<span class="linenos">128</span>                    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_interface</span><span class="o">.</span><span class="n">create_device_by_id</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
<span class="linenos">129</span>                <span class="k">except</span><span class="p">:</span>
<span class="linenos">130</span>                    <span class="k">pass</span>
<span class="linenos">131</span>
<span class="linenos">132</span>        <span class="k">if</span> <span class="n">st_device</span><span class="p">:</span>
<span class="linenos">133</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">134</span>                <span class="n">do_grabbing</span><span class="p">(</span><span class="n">st_device</span><span class="p">)</span>
<span class="linenos">135</span>            <span class="k">except</span><span class="p">:</span>
<span class="linenos">136</span>                <span class="k">if</span> <span class="ow">not</span> <span class="n">st_device</span><span class="o">.</span><span class="n">is_device_lost</span><span class="p">:</span>
<span class="linenos">137</span>                    <span class="k">raise</span>
<span class="linenos">138</span>
<span class="linenos">139</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0 : Reopen the same device&quot;</span><span class="p">)</span>
<span class="linenos">140</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Warning: for GigEVision device, you may need to set the &quot;</span>
<span class="linenos">141</span>              <span class="s2">&quot;camera IP to persistent before running this example&quot;</span><span class="p">)</span>
<span class="linenos">142</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Else : Exit&quot;</span><span class="p">)</span>
<span class="linenos">143</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Selection :&quot;</span><span class="p">)</span>
<span class="linenos">144</span>        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
<span class="linenos">145</span>            <span class="k">break</span>
<span class="linenos">146</span>
<span class="linenos">147</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">148</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="featurelist-py">
<h3>featurelist.py<a class="headerlink" href="#featurelist-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample will list all support functions of connected camera.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 6</span><span class="sd"> - Access Nodes of NodeMap for displaying camera&#39;s features</span>
<span class="linenos"> 7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">10</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">def</span> <span class="nf">display_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
<span class="linenos">13</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">14</span><span class="sd">    Function to display node</span>
<span class="linenos">15</span><span class="sd">    </span>
<span class="linenos">16</span><span class="sd">    :param node: node to display</span>
<span class="linenos">17</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">18</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_implemented</span><span class="p">:</span>
<span class="linenos">19</span>        <span class="k">return</span>
<span class="linenos">20</span>    <span class="c1"># Display the interface type and name</span>
<span class="linenos">21</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="linenos">22</span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">ICategory</span><span class="p">:</span>
<span class="linenos">23</span>        <span class="c1"># Display all the features that belong to the category</span>
<span class="linenos">24</span>        <span class="n">feature_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyICategory</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">feature_list</span>
<span class="linenos">25</span>        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
<span class="linenos">26</span>            <span class="n">display_nodes</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="linenos">27</span>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">principal_interface_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCInterfaceType</span><span class="o">.</span><span class="n">IEnumeration</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="c1"># Display all entries if the type is Enumeration</span>
<span class="linenos">29</span>        <span class="n">entry_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos">30</span>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entry_list</span><span class="p">:</span>
<span class="linenos">31</span>            <span class="n">display_nodes</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">34</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">35</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">38</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos">41</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">44</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="c1"># Display nodes</span>
<span class="linenos">47</span>    <span class="n">display_nodes</span><span class="p">(</span><span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Root&quot;</span><span class="p">))</span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">50</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="framestart-trigger-py">
<h3>framestart_trigger.py<a class="headerlink" href="#framestart-trigger-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use trigger mode of the camera</span>
<span class="linenos">  3</span><span class="sd"> The The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Set trigger mode and send trigger</span>
<span class="linenos">  7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="n">TRIGGER_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;TriggerSelector&quot;</span>
<span class="linenos"> 12</span><span class="n">TRIGGER_SELECTOR_FRAME_START</span> <span class="o">=</span> <span class="s2">&quot;FrameStart&quot;</span>
<span class="linenos"> 13</span><span class="n">TRIGGER_SELECTOR_EXPOSURE_START</span> <span class="o">=</span> <span class="s2">&quot;ExposureStart&quot;</span>
<span class="linenos"> 14</span><span class="n">TRIGGER_MODE</span> <span class="o">=</span> <span class="s2">&quot;TriggerMode&quot;</span>
<span class="linenos"> 15</span><span class="n">TRIGGER_MODE_ON</span> <span class="o">=</span> <span class="s2">&quot;On&quot;</span>
<span class="linenos"> 16</span><span class="n">TRIGGER_MODE_OFF</span> <span class="o">=</span> <span class="s2">&quot;Off&quot;</span>
<span class="linenos"> 17</span><span class="n">TRIGGER_SOURCE</span> <span class="o">=</span> <span class="s2">&quot;TriggerSource&quot;</span>
<span class="linenos"> 18</span><span class="n">TRIGGER_SOURCE_SOFTWARE</span> <span class="o">=</span> <span class="s2">&quot;Software&quot;</span>
<span class="linenos"> 19</span><span class="n">TRIGGER_SOFTWARE</span> <span class="o">=</span> <span class="s2">&quot;TriggerSoftware&quot;</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 23</span><span class="sd">    Callback to handle events from DataStream.</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="sd">    :param handle: handle that trigger the callback.</span>
<span class="linenos"> 26</span><span class="sd">    :param context: user data passed on during callback registration.</span>
<span class="linenos"> 27</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 28</span>    <span class="k">if</span> <span class="n">handle</span><span class="o">.</span><span class="n">callback_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStCallbackType</span><span class="o">.</span><span class="n">GenTLDataStreamNewBuffer</span><span class="p">:</span>
<span class="linenos"> 29</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 30</span>            <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos"> 31</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 32</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 33</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 34</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos"> 35</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 36</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 37</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 38</span>                          <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 39</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 40</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 41</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 42</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos"> 43</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos"> 44</span>        <span class="k">except</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos"> 45</span>           <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An exception occurred.&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="k">def</span> <span class="nf">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">):</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 50</span><span class="sd">    Function to set enumeration value.</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="sd">    :param nodemap: node map.</span>
<span class="linenos"> 53</span><span class="sd">    :param enum_name:  name of the enumeration node.</span>
<span class="linenos"> 54</span><span class="sd">    :param entry_name:  symbolic value of the enumeration entry node.</span>
<span class="linenos"> 55</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 56</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">))</span>
<span class="linenos"> 57</span>    <span class="n">entry_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_node</span><span class="p">[</span><span class="n">entry_name</span><span class="p">])</span>
<span class="linenos"> 58</span>    <span class="c1"># Note that depending on your use case, there are three ways to set</span>
<span class="linenos"> 59</span>    <span class="c1"># the enumeration value:</span>
<span class="linenos"> 60</span>    <span class="c1"># 1) Assign the integer value of the entry with set_int_value(val) or .value</span>
<span class="linenos"> 61</span>    <span class="c1"># 2) Assign the symbolic value of the entry with set_symbolic_value(&quot;val&quot;)</span>
<span class="linenos"> 62</span>    <span class="c1"># 3) Assign the entry (PyIEnumEntry) with set_entry_value(entry)</span>
<span class="linenos"> 63</span>    <span class="c1"># Here set_entry_value is used:</span>
<span class="linenos"> 64</span>    <span class="n">enum_node</span><span class="o">.</span><span class="n">set_entry_value</span><span class="p">(</span><span class="n">entry_node</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 68</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 69</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 70</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 73</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 76</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 79</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>        <span class="c1"># Get the nodemap for the camera settings.</span>
<span class="linenos"> 82</span>        <span class="n">nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>        <span class="c1"># Set the TriggerSelector for FrameStart or ExposureStart.</span>
<span class="linenos"> 85</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 86</span>            <span class="n">set_enumeration</span><span class="p">(</span>
<span class="linenos"> 87</span>                <span class="n">nodemap</span><span class="p">,</span> <span class="n">TRIGGER_SELECTOR</span><span class="p">,</span> <span class="n">TRIGGER_SELECTOR_FRAME_START</span><span class="p">)</span>
<span class="linenos"> 88</span>        <span class="k">except</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStError</span><span class="p">:</span>
<span class="linenos"> 89</span>            <span class="n">set_enumeration</span><span class="p">(</span>
<span class="linenos"> 90</span>                <span class="n">nodemap</span><span class="p">,</span> <span class="n">TRIGGER_SELECTOR</span><span class="p">,</span> <span class="n">TRIGGER_SELECTOR_EXPOSURE_START</span><span class="p">)</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>        <span class="c1"># Set the TriggerMode to On.</span>
<span class="linenos"> 93</span>        <span class="n">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">TRIGGER_MODE</span><span class="p">,</span> <span class="n">TRIGGER_MODE_ON</span><span class="p">)</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>        <span class="c1"># Set the TriggerSource to Software</span>
<span class="linenos"> 96</span>        <span class="n">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">TRIGGER_SOURCE</span><span class="p">,</span> <span class="n">TRIGGER_SOURCE_SOFTWARE</span><span class="p">)</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>        <span class="c1"># Get and cast to Command interface of the TriggerSoftware mode</span>
<span class="linenos"> 99</span>        <span class="n">trigger_software</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyICommand</span><span class="p">(</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">TRIGGER_SOFTWARE</span><span class="p">))</span>
<span class="linenos">100</span>
<span class="linenos">101</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">102</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">103</span>
<span class="linenos">104</span>        <span class="c1"># Register callback for datastream</span>
<span class="linenos">105</span>        <span class="n">callback</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">datastream_callback</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">108</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">109</span>
<span class="linenos">110</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">111</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">112</span>
<span class="linenos">113</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">114</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0 : Generate trigger&quot;</span><span class="p">)</span>
<span class="linenos">115</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Else : Exit&quot;</span><span class="p">)</span>
<span class="linenos">116</span>            <span class="n">selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select : &quot;</span><span class="p">)</span>
<span class="linenos">117</span>            <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
<span class="linenos">118</span>                <span class="n">trigger_software</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">119</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">120</span>               <span class="k">break</span>
<span class="linenos">121</span>
<span class="linenos">122</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">123</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">124</span>
<span class="linenos">125</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">126</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">127</span>
<span class="linenos">128</span>        <span class="c1"># Set the TriggerMode to Off.</span>
<span class="linenos">129</span>        <span class="n">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">TRIGGER_MODE</span><span class="p">,</span> <span class="n">TRIGGER_MODE_OFF</span><span class="p">)</span>
<span class="linenos">130</span>
<span class="linenos">131</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">132</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gige-action-command-py">
<h3>gige_action_command.py<a class="headerlink" href="#gige-action-command-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use GigE Action command.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to GigE camera</span>
<span class="linenos">  6</span><span class="sd"> - Set and send action command</span>
<span class="linenos">  7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="n">DEVICE_KEY</span> <span class="o">=</span> <span class="mh">0x12345678</span>
<span class="linenos"> 13</span><span class="n">GROUP_KEY</span> <span class="o">=</span> <span class="mh">0x00000001</span>
<span class="linenos"> 14</span><span class="n">GROUP_MASK</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span>
<span class="linenos"> 15</span><span class="n">SCHEDULED_TIME_ENABLE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="n">scheduled_time</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="k">class</span> <span class="nc">CActionCommandEvent</span><span class="p">:</span>
<span class="linenos"> 21</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
<span class="linenos"> 22</span>        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
<span class="linenos"> 23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">callback_func_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command_sent</span>
<span class="linenos"> 24</span>        <span class="bp">self</span><span class="o">.</span><span class="n">callback_func_recv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_ack_received</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>        <span class="n">nodemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 27</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommand&quot;</span><span class="p">)</span>
<span class="linenos"> 28</span>        <span class="bp">self</span><span class="o">.</span><span class="n">cb_command_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span>
<span class="linenos"> 29</span>            <span class="bp">self</span><span class="o">.</span><span class="n">callback_func_sent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCCallbackType</span><span class="o">.</span><span class="n">OutsideLock</span><span class="p">)</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_req_id</span> <span class="o">=</span> \
<span class="linenos"> 32</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommandRequestID&quot;</span><span class="p">)</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack</span> <span class="o">=</span> \
<span class="linenos"> 35</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommandAcknowledge&quot;</span><span class="p">)</span>
<span class="linenos"> 36</span>        <span class="bp">self</span><span class="o">.</span><span class="n">cb_ack_received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span>
<span class="linenos"> 37</span>            <span class="bp">self</span><span class="o">.</span><span class="n">callback_func_recv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">EGCCallbackType</span><span class="o">.</span><span class="n">OutsideLock</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_src_ip</span> <span class="o">=</span> \
<span class="linenos"> 40</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommandAcknowledgeSourceIPAddress&quot;</span><span class="p">)</span>
<span class="linenos"> 41</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_status</span> <span class="o">=</span> \
<span class="linenos"> 42</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommandAcknowledgeStatus&quot;</span><span class="p">)</span>
<span class="linenos"> 43</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_id</span> <span class="o">=</span> \
<span class="linenos"> 44</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventActionCommandAcknowledgeAcknowledgeID&quot;</span><span class="p">)</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>        <span class="bp">self</span><span class="o">.</span><span class="n">gev_action_dest_ip</span> <span class="o">=</span> \
<span class="linenos"> 47</span>            <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;GevActionDestinationIPAddress&quot;</span><span class="p">)</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 50</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd</span><span class="o">.</span><span class="n">deregister_callbacks</span><span class="p">()</span>
<span class="linenos"> 51</span>        <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack</span><span class="o">.</span><span class="n">deregister_callbacks</span><span class="p">()</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>    <span class="k">def</span> <span class="nf">on_command_sent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos"> 54</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback function triggered when action command is sent.&quot;&quot;&quot;</span>
<span class="linenos"> 55</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sent action command[</span><span class="si">{0}</span><span class="s2">]: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 56</span>            <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_req_id</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos"> 57</span>            <span class="bp">self</span><span class="o">.</span><span class="n">gev_action_dest_ip</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
<span class="linenos"> 58</span>        <span class="p">))</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>    <span class="k">def</span> <span class="nf">on_ack_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="linenos"> 61</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback function triggered when action command ack is received.&quot;&quot;&quot;</span>
<span class="linenos"> 62</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received action command[</span><span class="si">{0}</span><span class="s2">] : </span><span class="si">{1}</span><span class="s2">(</span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 63</span>            <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_id</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos"> 64</span>            <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_src_ip</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">(),</span>
<span class="linenos"> 65</span>            <span class="bp">self</span><span class="o">.</span><span class="n">event_action_cmd_ack_status</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">current_entry</span><span class="o">.</span><span class="n">display_name</span>
<span class="linenos"> 66</span>        <span class="p">))</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="k">class</span> <span class="nc">CActionCommandInterface</span><span class="p">:</span>
<span class="linenos"> 70</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
<span class="linenos"> 71</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_iface</span> <span class="o">=</span> <span class="n">iface</span>
<span class="linenos"> 72</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_action_cmd_event</span> <span class="o">=</span> <span class="n">CActionCommandEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iface</span><span class="p">)</span>
<span class="linenos"> 73</span>        <span class="n">nodemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 74</span>        <span class="bp">self</span><span class="o">.</span><span class="n">action_cmd</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionCommand&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>    <span class="k">def</span> <span class="nf">get_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 77</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iface</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 80</span>        <span class="bp">self</span><span class="o">.</span><span class="n">action_cmd</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="k">def</span> <span class="nf">send_action_command</span><span class="p">(</span><span class="n">action_interfaces</span><span class="p">):</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Send action command.&quot;&quot;&quot;</span>
<span class="linenos"> 85</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 86</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Input (0: Action Command, 1: Exit) : &quot;</span><span class="p">)</span>
<span class="linenos"> 87</span>        <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
<span class="linenos"> 88</span>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">action_interfaces</span><span class="p">:</span>
<span class="linenos"> 89</span>               <span class="n">item</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos"> 90</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="linenos"> 91</span>        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
<span class="linenos"> 92</span>            <span class="k">break</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span><span class="k">def</span> <span class="nf">adjust_gev_scpd</span><span class="p">(</span><span class="n">device_list</span><span class="p">):</span>
<span class="linenos"> 96</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust GevSCPD for the devices in the device_list.&quot;&quot;&quot;</span>
<span class="linenos"> 97</span>    <span class="n">packet_size</span> <span class="o">=</span> <span class="n">device_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos"> 98</span>        <span class="s2">&quot;GevSCPSPacketSize&quot;</span><span class="p">)</span>
<span class="linenos"> 99</span>    <span class="k">if</span> <span class="n">packet_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">100</span>        <span class="k">return</span>
<span class="linenos">101</span>
<span class="linenos">102</span>    <span class="n">timestamp_latch</span> <span class="o">=</span> <span class="n">device_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos">103</span>        <span class="s2">&quot;TimestampLatchValue&quot;</span><span class="p">)</span>
<span class="linenos">104</span>    <span class="k">if</span> <span class="n">timestamp_latch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">105</span>        <span class="k">return</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="n">max_bps</span> <span class="o">=</span> <span class="mi">100000000</span>
<span class="linenos">108</span>    <span class="n">each_packet_time_ns</span> <span class="o">=</span> <span class="n">packet_size</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">1000000000</span> <span class="o">*</span> \
<span class="linenos">109</span>                          <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">device_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_bps</span>
<span class="linenos">110</span>    <span class="n">timestamp_unit</span> <span class="o">=</span> <span class="n">timestamp_latch</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">inc</span>
<span class="linenos">111</span>    <span class="k">if</span> <span class="n">timestamp_unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">112</span>        <span class="n">timestamp_unit</span> <span class="o">=</span> <span class="mi">40</span>
<span class="linenos">113</span>    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">device_list</span><span class="p">:</span>
<span class="linenos">114</span>        <span class="n">device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;GevSCPD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> \
<span class="linenos">115</span>            <span class="n">each_packet_time_ns</span> <span class="o">/</span> <span class="n">timestamp_unit</span>
<span class="linenos">116</span>
<span class="linenos">117</span>
<span class="linenos">118</span><span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">119</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">120</span><span class="sd">    Callback to handle events from DataStream.</span>
<span class="linenos">121</span>
<span class="linenos">122</span><span class="sd">    :param handle: handle that trigger the callback.</span>
<span class="linenos">123</span><span class="sd">    :param context: user data passed on during callback registration.</span>
<span class="linenos">124</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">125</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos">126</span>    <span class="k">if</span> <span class="n">st_datastream</span><span class="p">:</span>
<span class="linenos">127</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">128</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">129</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">130</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">131</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">132</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">133</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">134</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">135</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">136</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">137</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">138</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">139</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">140</span>
<span class="linenos">141</span>
<span class="linenos">142</span><span class="k">def</span> <span class="nf">set_device_action_cmd_param</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
<span class="linenos">143</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set device action command parameters.&quot;&quot;&quot;</span>
<span class="linenos">144</span>    <span class="n">nodemap</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">145</span>    <span class="n">trigger_selector</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;TriggerSelector&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">146</span>    <span class="n">trigger_selector</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="s2">&quot;FrameStart&quot;</span><span class="p">)</span>
<span class="linenos">147</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; TriggerSelector = FrameStart&quot;</span><span class="p">)</span>
<span class="linenos">148</span>
<span class="linenos">149</span>    <span class="n">trigger_mode</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;TriggerMode&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">150</span>    <span class="n">trigger_mode</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="s2">&quot;On&quot;</span><span class="p">)</span>
<span class="linenos">151</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; TriggerMode = On&quot;</span><span class="p">)</span>
<span class="linenos">152</span>
<span class="linenos">153</span>    <span class="n">trigger_source</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;TriggerSource&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">154</span>    <span class="n">trigger_source_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Action0&quot;</span><span class="p">,</span> <span class="s2">&quot;Action1&quot;</span><span class="p">]</span>
<span class="linenos">155</span>    <span class="k">for</span> <span class="n">trigger_src_name</span> <span class="ow">in</span> <span class="n">trigger_source_list</span><span class="p">:</span>
<span class="linenos">156</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">157</span>            <span class="n">trigger_source</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">trigger_src_name</span><span class="p">)</span>
<span class="linenos">158</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; TriggerSource =&quot;</span><span class="p">,</span> <span class="n">trigger_src_name</span><span class="p">)</span>
<span class="linenos">159</span>            <span class="k">break</span>
<span class="linenos">160</span>        <span class="k">except</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStError</span><span class="p">:</span>
<span class="linenos">161</span>            <span class="k">pass</span>
<span class="linenos">162</span>
<span class="linenos">163</span>    <span class="n">action_device_key</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionDeviceKey&quot;</span><span class="p">)</span>
<span class="linenos">164</span>    <span class="n">action_device_key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">DEVICE_KEY</span>
<span class="linenos">165</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionDeviceKey =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">DEVICE_KEY</span><span class="p">))</span>
<span class="linenos">166</span>
<span class="linenos">167</span>    <span class="n">action_selector</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionSelector&quot;</span><span class="p">)</span>
<span class="linenos">168</span>    <span class="n">action_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">action_selector</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">min</span>
<span class="linenos">169</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionSelector =&quot;</span><span class="p">,</span> <span class="n">action_selector</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
<span class="linenos">170</span>
<span class="linenos">171</span>    <span class="n">action_group_key</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionGroupKey&quot;</span><span class="p">)</span>
<span class="linenos">172</span>    <span class="n">action_group_key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GROUP_KEY</span>
<span class="linenos">173</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionGroupKey =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">GROUP_KEY</span><span class="p">))</span>
<span class="linenos">174</span>
<span class="linenos">175</span>    <span class="n">action_group_mask</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionGroupMask&quot;</span><span class="p">)</span>
<span class="linenos">176</span>    <span class="n">action_group_mask</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GROUP_MASK</span>
<span class="linenos">177</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionGroupMask =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">GROUP_MASK</span><span class="p">))</span>
<span class="linenos">178</span>
<span class="linenos">179</span>
<span class="linenos">180</span><span class="k">def</span> <span class="nf">set_host_action_cmd_param</span><span class="p">(</span><span class="n">iface</span><span class="p">):</span>
<span class="linenos">181</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set host action command parameters.&quot;&quot;&quot;</span>
<span class="linenos">182</span>    <span class="n">nodemap</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">183</span>    <span class="n">event_selector</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventSelector&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">184</span>    <span class="n">event_notification</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;EventNotification&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">185</span>
<span class="linenos">186</span>    <span class="n">event_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ActionCommand&quot;</span><span class="p">,</span> <span class="s2">&quot;ActionCommandAcknowledge&quot;</span><span class="p">]</span>
<span class="linenos">187</span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event_names</span><span class="p">:</span>
<span class="linenos">188</span>        <span class="n">event_selector</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="linenos">189</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; EventSelector =&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<span class="linenos">190</span>        <span class="n">event_notification</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="s2">&quot;On&quot;</span><span class="p">)</span>
<span class="linenos">191</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; EventNotification = On&quot;</span><span class="p">)</span>
<span class="linenos">192</span>
<span class="linenos">193</span>    <span class="n">action_device_key</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionDeviceKey&quot;</span><span class="p">)</span>
<span class="linenos">194</span>    <span class="n">action_device_key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">DEVICE_KEY</span>
<span class="linenos">195</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionDeviceKey =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">DEVICE_KEY</span><span class="p">))</span>
<span class="linenos">196</span>
<span class="linenos">197</span>    <span class="n">action_group_key</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionGroupKey&quot;</span><span class="p">)</span>
<span class="linenos">198</span>    <span class="n">action_group_key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GROUP_KEY</span>
<span class="linenos">199</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionGroupKey =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">GROUP_KEY</span><span class="p">))</span>
<span class="linenos">200</span>
<span class="linenos">201</span>    <span class="n">action_group_mask</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionGroupMask&quot;</span><span class="p">)</span>
<span class="linenos">202</span>    <span class="n">action_group_mask</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GROUP_MASK</span>
<span class="linenos">203</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionGroupMask =&quot;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">GROUP_MASK</span><span class="p">))</span>
<span class="linenos">204</span>
<span class="linenos">205</span>    <span class="n">action_scheduled_time_enable</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionScheduledTimeEnable&quot;</span><span class="p">)</span>
<span class="linenos">206</span>    <span class="n">action_scheduled_time_enable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">SCHEDULED_TIME_ENABLE</span>
<span class="linenos">207</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionScheduledTimeEnable =&quot;</span><span class="p">,</span> <span class="n">SCHEDULED_TIME_ENABLE</span><span class="p">)</span>
<span class="linenos">208</span>    <span class="k">if</span> <span class="n">SCHEDULED_TIME_ENABLE</span><span class="p">:</span>
<span class="linenos">209</span>        <span class="n">action_scheduled_time</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;ActionScheduledTime&quot;</span><span class="p">)</span>
<span class="linenos">210</span>        <span class="n">action_scheduled_time</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">scheduled_time</span>
<span class="linenos">211</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ActionScheduledTIme =&quot;</span><span class="p">,</span> <span class="n">scheduled_time</span><span class="p">)</span>
<span class="linenos">212</span>
<span class="linenos">213</span>
<span class="linenos">214</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">215</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">216</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">217</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">218</span>
<span class="linenos">219</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">220</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStSystemVendor</span><span class="o">.</span><span class="n">Default</span><span class="p">,</span>
<span class="linenos">221</span>                                     <span class="n">st</span><span class="o">.</span><span class="n">EStInterfaceType</span><span class="o">.</span><span class="n">GigEVision</span><span class="p">)</span>
<span class="linenos">222</span>
<span class="linenos">223</span>        <span class="n">st_action_interfaces</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">224</span>
<span class="linenos">225</span>        <span class="c1"># Check if there is no GigE device, raise Exception.</span>
<span class="linenos">226</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">st_system</span><span class="o">.</span><span class="n">interface_count</span><span class="p">):</span>
<span class="linenos">227</span>            <span class="n">iface</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="linenos">228</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">229</span>                <span class="n">iface_subnet_ip</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos">230</span>                    <span class="s2">&quot;GevInterfaceSubnetIPAddress&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">231</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interface </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2"> [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">232</span>                    <span class="n">index</span><span class="p">,</span> <span class="n">iface</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span>
<span class="linenos">233</span>                    <span class="n">iface_subnet_ip</span><span class="o">.</span><span class="n">to_string</span><span class="p">()))</span>
<span class="linenos">234</span>                <span class="n">set_host_action_cmd_param</span><span class="p">(</span><span class="n">iface</span><span class="p">)</span>
<span class="linenos">235</span>                <span class="n">iface</span><span class="o">.</span><span class="n">start_event_acquisition</span><span class="p">()</span>
<span class="linenos">236</span>                <span class="n">action_interface</span> <span class="o">=</span> <span class="n">CActionCommandInterface</span><span class="p">(</span><span class="n">iface</span><span class="p">)</span>
<span class="linenos">237</span>                <span class="n">st_action_interfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_interface</span><span class="p">)</span>
<span class="linenos">238</span>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">239</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An exception occurred.&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>
<span class="linenos">240</span>
<span class="linenos">241</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">st_action_interfaces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">242</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;There is no GigE interface found.&quot;</span><span class="p">)</span>
<span class="linenos">243</span>
<span class="linenos">244</span>        <span class="c1"># Try to connect to all possible device:</span>
<span class="linenos">245</span>        <span class="n">st_devices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">246</span>        <span class="n">st_datastreams</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">247</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">248</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">249</span>                <span class="n">st_devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">())</span>
<span class="linenos">250</span>            <span class="k">except</span><span class="p">:</span>
<span class="linenos">251</span>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">252</span>                    <span class="k">raise</span>
<span class="linenos">253</span>                <span class="k">break</span>
<span class="linenos">254</span>
<span class="linenos">255</span>            <span class="c1"># Display the DisplayName of the device.</span>
<span class="linenos">256</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2"> [</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">),</span>
<span class="linenos">257</span>                  <span class="n">st_devices</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span>
<span class="linenos">258</span>                  <span class="n">st_devices</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">local_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos">259</span>                      <span class="s2">&quot;GevDeviceIPAddress&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">()))</span>
<span class="linenos">260</span>
<span class="linenos">261</span>            <span class="c1"># Set action command parameter.</span>
<span class="linenos">262</span>            <span class="n">set_device_action_cmd_param</span><span class="p">(</span><span class="n">st_devices</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">263</span>
<span class="linenos">264</span>            <span class="c1"># Create a DataStream object.</span>
<span class="linenos">265</span>            <span class="n">st_datastreams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="linenos">266</span>                <span class="n">st_devices</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">())</span>
<span class="linenos">267</span>
<span class="linenos">268</span>            <span class="c1"># Register callback for grabbing.</span>
<span class="linenos">269</span>            <span class="n">st_datastreams</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st_datastreams</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span>
<span class="linenos">270</span>                <span class="n">datastream_callback</span><span class="p">)</span>
<span class="linenos">271</span>
<span class="linenos">272</span>        <span class="c1"># Start the image acquisition of the host side.</span>
<span class="linenos">273</span>        <span class="k">for</span> <span class="n">datastream</span> <span class="ow">in</span> <span class="n">st_datastreams</span><span class="p">:</span>
<span class="linenos">274</span>            <span class="n">datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">275</span>
<span class="linenos">276</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">277</span>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">st_devices</span><span class="p">:</span>
<span class="linenos">278</span>            <span class="n">device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">279</span>
<span class="linenos">280</span>        <span class="c1"># Adjust GevSCPD and send action command.</span>
<span class="linenos">281</span>        <span class="n">adjust_gev_scpd</span><span class="p">(</span><span class="n">st_devices</span><span class="p">)</span>
<span class="linenos">282</span>        <span class="n">send_action_command</span><span class="p">(</span><span class="n">st_action_interfaces</span><span class="p">)</span>
<span class="linenos">283</span>
<span class="linenos">284</span>        <span class="c1"># Stop the image acquisition of the camera side.</span>
<span class="linenos">285</span>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">st_devices</span><span class="p">:</span>
<span class="linenos">286</span>            <span class="n">device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">287</span>
<span class="linenos">288</span>        <span class="c1"># Stop the image acquisition of the host side.</span>
<span class="linenos">289</span>        <span class="k">for</span> <span class="n">datastream</span> <span class="ow">in</span> <span class="n">st_datastreams</span><span class="p">:</span>
<span class="linenos">290</span>            <span class="n">datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">291</span>
<span class="linenos">292</span>        <span class="c1"># Stop event acquisition thread.</span>
<span class="linenos">293</span>        <span class="k">for</span> <span class="n">action_interface</span> <span class="ow">in</span> <span class="n">st_action_interfaces</span><span class="p">:</span>
<span class="linenos">294</span>            <span class="n">action_interface</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">stop_event_acquisition</span><span class="p">()</span>
<span class="linenos">295</span>
<span class="linenos">296</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">297</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gige-configurations-py">
<h3>gige_configurations.py<a class="headerlink" href="#gige-configurations-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to setup the IP address and heartbeat timeout of GigE camera.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Acquire image data</span>
<span class="linenos">  7</span><span class="sd"> - Check and update IP address of GigE camera</span>
<span class="linenos">  8</span><span class="sd"> - Update heartbeat timeout of GigE camera</span>
<span class="linenos">  9</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 12</span><span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 16</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Feature names</span>
<span class="linenos"> 19</span><span class="n">GEV_INTERFACE_SUBNET_IP_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;GevInterfaceSubnetIPAddress&quot;</span>
<span class="linenos"> 20</span><span class="n">GEV_INTERFACE_SUBNET_MASK</span> <span class="o">=</span> <span class="s2">&quot;GevInterfaceSubnetMask&quot;</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="n">DEVICE_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;DeviceSelector&quot;</span>
<span class="linenos"> 23</span><span class="n">GEV_DEVICE_IP_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;GevDeviceIPAddress&quot;</span>
<span class="linenos"> 24</span><span class="n">GEV_DEVICE_SUBNET_MASK</span> <span class="o">=</span> <span class="s2">&quot;GevDeviceSubnetMask&quot;</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="n">GEV_DEVICE_FORCE_IP_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;GevDeviceForceIPAddress&quot;</span>
<span class="linenos"> 27</span><span class="n">GEV_DEVICE_FORCE_SUBNET_MASK</span> <span class="o">=</span> <span class="s2">&quot;GevDeviceForceSubnetMask&quot;</span>
<span class="linenos"> 28</span><span class="n">GEV_DEVICE_FORCE_IP</span> <span class="o">=</span> <span class="s2">&quot;GevDeviceForceIP&quot;</span>
<span class="linenos"> 29</span><span class="n">DEVICE_LINK_HEARTBEAT_TIMEOUT</span> <span class="o">=</span> <span class="s2">&quot;DeviceLinkHeartbeatTimeout&quot;</span>
<span class="linenos"> 30</span><span class="n">GEV_HEARTBEAT_TIMEOUT</span> <span class="o">=</span> <span class="s2">&quot;GevHeartbeatTimeout&quot;</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="k">def</span> <span class="nf">update_device_ip_address</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos"> 34</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 35</span><span class="sd">    Function for checking and updating device IP address.</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="sd">    :param nodemap: node map of the device.</span>
<span class="linenos"> 38</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 39</span>    <span class="c1"># Display the IP address of the host side.</span>
<span class="linenos"> 40</span>    <span class="n">iface_ip</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_INTERFACE_SUBNET_IP_ADDRESS</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 41</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interface IP address =&quot;</span><span class="p">,</span> <span class="n">iface_ip</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>    <span class="c1"># Display the subnet mask of the host side.</span>
<span class="linenos"> 44</span>    <span class="n">iface_mask</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_INTERFACE_SUBNET_MASK</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 45</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interface Subnet mask =&quot;</span><span class="p">,</span> <span class="n">iface_mask</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 48</span>        <span class="c1"># Select the first device.</span>
<span class="linenos"> 49</span>        <span class="n">device_selector</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">DEVICE_SELECTOR</span><span class="p">)</span>
<span class="linenos"> 50</span>        <span class="n">device_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>        <span class="c1"># Display the current IP address of the device.</span>
<span class="linenos"> 53</span>        <span class="n">device_ip</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_IP_ADDRESS</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 54</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device IP Address =&quot;</span><span class="p">,</span> <span class="n">device_ip</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span>        <span class="c1"># Display the current subnet mask of the device.</span>
<span class="linenos"> 57</span>        <span class="n">device_mask</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_SUBNET_MASK</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 58</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device Subnet Mask =&quot;</span><span class="p">,</span> <span class="n">device_mask</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>        <span class="n">new_ip_str</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Input new device IP address (x.x.x.x) : &quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="n">new_ip_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">new_ip_str</span><span class="p">))</span>
<span class="linenos"> 62</span>        <span class="n">iface_ip_int</span> <span class="o">=</span> <span class="n">iface_ip</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 63</span>        <span class="n">iface_mask_int</span> <span class="o">=</span> <span class="n">iface_mask</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span>        <span class="c1"># Ensure the subnet address of the host and the device are matched</span>
<span class="linenos"> 66</span>        <span class="c1"># and the host and the device have different IP address.</span>
<span class="linenos"> 67</span>        <span class="k">if</span> <span class="p">(</span><span class="n">iface_ip_int</span> <span class="o">&amp;</span> <span class="n">iface_mask_int</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">new_ip_int</span> <span class="o">&amp;</span> <span class="n">iface_mask_int</span><span class="p">)</span>\
<span class="linenos"> 68</span>                <span class="ow">and</span> <span class="n">iface_ip_int</span> <span class="o">!=</span> <span class="n">new_ip_int</span><span class="p">:</span>
<span class="linenos"> 69</span>            <span class="c1"># Specify the new ip address of the device.</span>
<span class="linenos"> 70</span>            <span class="n">force_ip</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_FORCE_IP_ADDRESS</span><span class="p">)</span>
<span class="linenos"> 71</span>            <span class="n">force_ip</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_ip_int</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>            <span class="c1"># Specify the new subnet mask of the device.</span>
<span class="linenos"> 74</span>            <span class="n">force_mask</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_FORCE_SUBNET_MASK</span><span class="p">)</span>
<span class="linenos"> 75</span>            <span class="n">force_mask</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">iface_mask_int</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>            <span class="c1"># Update the device setting.</span>
<span class="linenos"> 78</span>            <span class="n">force_ip_cmd</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_FORCE_IP</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 79</span>            <span class="n">force_ip_cmd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos"> 80</span>            <span class="k">return</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="k">def</span> <span class="nf">update_heartbeat_timeout</span><span class="p">(</span><span class="n">nodemap</span><span class="p">):</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 85</span><span class="sd">    Function for reading and updating heartbeat timeout.</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="sd">    :param nodemap: nodemap of the device.</span>
<span class="linenos"> 88</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 89</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 90</span>        <span class="n">heartbeat</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">DEVICE_LINK_HEARTBEAT_TIMEOUT</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 91</span>        <span class="k">if</span> <span class="n">heartbeat</span><span class="p">:</span>
<span class="linenos"> 92</span>            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;[us]&quot;</span>
<span class="linenos"> 93</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 94</span>            <span class="n">heartbeat</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_HEARTBEAT_TIMEOUT</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 95</span>            <span class="k">if</span> <span class="n">heartbeat</span><span class="p">:</span>
<span class="linenos"> 96</span>                <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;[ms]&quot;</span>
<span class="linenos"> 97</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 98</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to get the current heartbeat value&quot;</span><span class="p">)</span>
<span class="linenos"> 99</span>                <span class="k">return</span>
<span class="linenos">100</span>
<span class="linenos">101</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos">102</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: the heartbeat sending interval is fixed when the device &quot;</span>
<span class="linenos">103</span>              <span class="s2">&quot;is initialized (opened).&quot;</span><span class="p">)</span>
<span class="linenos">104</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Thus, changing the heartbeat timeout smaller than the current &quot;</span>
<span class="linenos">105</span>              <span class="s2">&quot;value may cause timeout.&quot;</span><span class="p">)</span>
<span class="linenos">106</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In practical situation, please either set environment variable &quot;</span>
<span class="linenos">107</span>              <span class="s2">&quot;STGENTL_GIGE_HEARTBEAT before opening the device&quot;</span><span class="p">)</span>
<span class="linenos">108</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;or re-open the device after changing the heartbeat value without &quot;</span>
<span class="linenos">109</span>              <span class="s2">&quot;setting the environment variable and debugger.&quot;</span><span class="p">)</span>
<span class="linenos">110</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos">111</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Heartbeat Timeout</span><span class="si">%s</span><span class="s2">=</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">heartbeat</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="linenos">112</span>
<span class="linenos">113</span>        <span class="c1"># Update the HeartbeatTimeout setting.</span>
<span class="linenos">114</span>        <span class="n">new_heartbeat</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Input new Heartbeat Timeout&quot;</span><span class="o">+</span><span class="n">unit</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="linenos">115</span>        <span class="n">heartbeat</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">new_heartbeat</span><span class="p">)</span>
<span class="linenos">116</span>        <span class="k">return</span>
<span class="linenos">117</span>
<span class="linenos">118</span>
<span class="linenos">119</span><span class="k">def</span> <span class="nf">create_ist_device_by_ip</span><span class="p">(</span><span class="n">pinterface</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStDevice</span><span class="p">:</span>
<span class="linenos">120</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">121</span><span class="sd">    Function to connect to device based on the given ip address.</span>
<span class="linenos">122</span>
<span class="linenos">123</span><span class="sd">    :param pinterface PyStDevice: interface of the device.</span>
<span class="linenos">124</span><span class="sd">    :param ip_address: IP address of the device in integer.</span>
<span class="linenos">125</span><span class="sd">    :return: connected device (PyStDevice).</span>
<span class="linenos">126</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">127</span>    <span class="n">pinterface</span><span class="o">.</span><span class="n">update_device_list</span><span class="p">()</span>
<span class="linenos">128</span>    <span class="n">iface_nodemap</span> <span class="o">=</span> <span class="n">pinterface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">129</span>    <span class="n">device_selector</span> <span class="o">=</span> <span class="n">iface_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;DeviceSelector&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos">130</span>    <span class="n">max_index</span> <span class="o">=</span> <span class="n">device_selector</span><span class="o">.</span><span class="n">max</span>
<span class="linenos">131</span>    <span class="n">device_ip</span> <span class="o">=</span> <span class="n">iface_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;GevDeviceIPAddress&quot;</span><span class="p">)</span>
<span class="linenos">132</span>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_index</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">133</span>        <span class="n">device_selector</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">index</span>
<span class="linenos">134</span>        <span class="k">if</span> <span class="n">device_ip</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos">135</span>            <span class="k">if</span> <span class="n">device_ip</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ip_address</span><span class="p">:</span>
<span class="linenos">136</span>                <span class="k">return</span> <span class="n">pinterface</span><span class="o">.</span><span class="n">create_device_by_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="linenos">137</span>    <span class="k">return</span> <span class="kc">None</span>
<span class="linenos">138</span>
<span class="linenos">139</span>
<span class="linenos">140</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">141</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">142</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">143</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">144</span>
<span class="linenos">145</span>        <span class="c1"># Create a system object for device scan and connection only for GigE.</span>
<span class="linenos">146</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStSystemVendor</span><span class="o">.</span><span class="n">Default</span><span class="p">,</span>
<span class="linenos">147</span>                                     <span class="n">st</span><span class="o">.</span><span class="n">EStInterfaceType</span><span class="o">.</span><span class="n">GigEVision</span><span class="p">)</span>
<span class="linenos">148</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">st_system</span><span class="o">.</span><span class="n">interface_count</span><span class="p">):</span>
<span class="linenos">149</span>            <span class="n">st_interface</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="linenos">150</span>            <span class="k">if</span> <span class="n">st_interface</span><span class="o">.</span><span class="n">device_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">151</span>                <span class="k">break</span>
<span class="linenos">152</span>
<span class="linenos">153</span>        <span class="c1"># Update the IP address setting of the first detected GigE device.</span>
<span class="linenos">154</span>        <span class="n">update_device_ip_address</span><span class="p">(</span><span class="n">st_interface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">155</span>
<span class="linenos">156</span>        <span class="c1"># Get the updated IP address</span>
<span class="linenos">157</span>        <span class="n">device_force_ip</span> <span class="o">=</span> <span class="n">st_interface</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>\
<span class="linenos">158</span>            <span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">GEV_DEVICE_FORCE_IP_ADDRESS</span><span class="p">)</span>
<span class="linenos">159</span>
<span class="linenos">160</span>        <span class="c1"># Create a camera device object and connect.</span>
<span class="linenos">161</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">162</span>        <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
<span class="linenos">163</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">164</span>            <span class="n">st_device</span> <span class="o">=</span> <span class="n">create_ist_device_by_ip</span><span class="p">(</span><span class="n">st_interface</span><span class="p">,</span>
<span class="linenos">165</span>                                                <span class="n">device_force_ip</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos">166</span>            <span class="k">if</span> <span class="n">st_device</span><span class="p">:</span>
<span class="linenos">167</span>                <span class="k">break</span>
<span class="linenos">168</span>        <span class="k">if</span> <span class="n">st_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">169</span>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;A device ip IP address </span><span class="si">{0}</span><span class="s2"> could not be found&quot;</span>\
<span class="linenos">170</span>                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device_force_ip</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">()))</span>
<span class="linenos">171</span>
<span class="linenos">172</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">173</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">174</span>
<span class="linenos">175</span>        <span class="c1"># Update the HeartBeatTimeout settings.</span>
<span class="linenos">176</span>        <span class="n">update_heartbeat_timeout</span><span class="p">(</span><span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">177</span>
<span class="linenos">178</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">179</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">180</span>
<span class="linenos">181</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">182</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">183</span>
<span class="linenos">184</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">185</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">186</span>
<span class="linenos">187</span>        <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">188</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">189</span>            <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">190</span>            <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos">191</span>            <span class="c1"># assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos">192</span>            <span class="c1"># properly.</span>
<span class="linenos">193</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">194</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">195</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">196</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">197</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">198</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">199</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">200</span>                          <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">201</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">202</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">203</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">204</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">205</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">206</span>
<span class="linenos">207</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">208</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">209</span>
<span class="linenos">210</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">211</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">212</span>
<span class="linenos">213</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">214</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gige-multicast-py">
<h3>gige_multicast.py<a class="headerlink" href="#gige-multicast-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use the multicast function of GigE camera for multiple receivers.</span>
<span class="linenos">  3</span><span class="sd"> The monitor clients must connect after any one client connect to camera in control mode.</span>
<span class="linenos">  4</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  5</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  6</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  7</span><span class="sd"> - Acquire image data (with waiting in main thread)</span>
<span class="linenos">  8</span><span class="sd"> - Connect to camera in control mode / monitor mode</span>
<span class="linenos">  9</span><span class="sd"> - Multicast the image data</span>
<span class="linenos"> 10</span><span class="sd"> - Broadcast the image data</span>
<span class="linenos"> 11</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 16</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Feature names</span>
<span class="linenos"> 19</span><span class="n">DESTINATION_IP_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;DestinationIPAddress&quot;</span>
<span class="linenos"> 20</span><span class="n">DESTINATION_PORT</span> <span class="o">=</span> <span class="s2">&quot;DestinationPort&quot;</span>
<span class="linenos"> 21</span><span class="n">TRANSMISSION_TYPE</span> <span class="o">=</span> <span class="s2">&quot;TransmissionType&quot;</span>
<span class="linenos"> 22</span><span class="n">TRANSMISSION_TYPE_USE_CAMERA_CONFIGURATION</span> <span class="o">=</span> <span class="s2">&quot;UseCameraConfiguration&quot;</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 25</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 26</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>    <span class="c1"># Select the connecting mode (control/monitor) of the camera.</span>
<span class="linenos"> 29</span>    <span class="c1"># You can connect to a camera in monitor mode if it has already connected</span>
<span class="linenos"> 30</span>    <span class="c1"># by other host with control mode.</span>
<span class="linenos"> 31</span>    <span class="c1"># Note if you connect to a camera in monitor mode, you cannot modify the</span>
<span class="linenos"> 32</span>    <span class="c1"># camera settings.</span>
<span class="linenos"> 33</span>    <span class="n">is_monitor</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 34</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 35</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos"> 36</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c : Control mode&quot;</span><span class="p">)</span>
<span class="linenos"> 37</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m : Monitor mode&quot;</span><span class="p">)</span>
<span class="linenos"> 38</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select a mode : &quot;</span><span class="p">)</span>
<span class="linenos"> 39</span>        <span class="k">if</span> <span class="n">selection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]:</span>
<span class="linenos"> 40</span>            <span class="k">continue</span>
<span class="linenos"> 41</span>        <span class="n">is_monitor</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="ow">or</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="k">else</span> <span class="kc">False</span>
<span class="linenos"> 42</span>        <span class="k">break</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStSystemVendor</span><span class="o">.</span><span class="n">Default</span><span class="p">,</span>
<span class="linenos"> 45</span>                                 <span class="n">st</span><span class="o">.</span><span class="n">EStInterfaceType</span><span class="o">.</span><span class="n">GigEVision</span><span class="p">)</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 48</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">(</span>
<span class="linenos"> 49</span>        <span class="n">st</span><span class="o">.</span><span class="n">ETLDeviceAccessFlags</span><span class="o">.</span><span class="n">AccessReadOnly</span> <span class="k">if</span> <span class="n">is_monitor</span> <span class="k">else</span> \
<span class="linenos"> 50</span>            <span class="n">st</span><span class="o">.</span><span class="n">ETLDeviceAccessFlags</span><span class="o">.</span><span class="n">AccessControl</span><span class="p">)</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 53</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 56</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>    <span class="c1"># Get the IENumeration of TransmissionType.</span>
<span class="linenos"> 59</span>    <span class="n">transtype</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span>\
<span class="linenos"> 60</span>        <span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">TRANSMISSION_TYPE</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 61</span>    <span class="c1"># Get the setting based on the connection type.</span>
<span class="linenos"> 62</span>    <span class="k">if</span> <span class="n">is_monitor</span><span class="p">:</span>
<span class="linenos"> 63</span>        <span class="n">camera_config</span> <span class="o">=</span> <span class="n">transtype</span><span class="p">[</span><span class="n">TRANSMISSION_TYPE_USE_CAMERA_CONFIGURATION</span><span class="p">]</span>
<span class="linenos"> 64</span>        <span class="n">transtype_value</span> <span class="o">=</span> <span class="n">camera_config</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 65</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 66</span>        <span class="n">transtype_list</span> <span class="o">=</span> <span class="n">transtype</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos"> 67</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 68</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Supported transmission types are as follows.&quot;</span><span class="p">)</span>
<span class="linenos"> 69</span>            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transtype_list</span><span class="p">)):</span>
<span class="linenos"> 70</span>               <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
<span class="linenos"> 71</span>                     <span class="n">transtype_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">))</span>
<span class="linenos"> 72</span>            <span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select a transmission type : &quot;</span><span class="p">))</span>
<span class="linenos"> 73</span>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">selection</span>  <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transtype_list</span><span class="p">):</span>
<span class="linenos"> 74</span>                <span class="n">transtype_value</span> <span class="o">=</span> <span class="n">transtype_list</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 75</span>                <span class="k">break</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="c1"># Configure the selected transmission type.</span>
<span class="linenos"> 78</span>    <span class="n">transtype</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">transtype_value</span><span class="p">)</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>    <span class="c1"># Get and display the IP address of the image data.</span>
<span class="linenos"> 81</span>    <span class="n">dest_ip</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">DESTINATION_IP_ADDRESS</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 82</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Destination IP Address =&quot;</span><span class="p">,</span> <span class="n">dest_ip</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 85</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>    <span class="c1"># Start the image acquisition of the camera side if in control mode.</span>
<span class="linenos"> 88</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_monitor</span><span class="p">:</span>
<span class="linenos"> 89</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos"> 92</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 93</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos"> 94</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos"> 95</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos"> 96</span>        <span class="c1">#          properly.</span>
<span class="linenos"> 97</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 98</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 99</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">100</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">101</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">102</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">103</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">104</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">105</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">106</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">107</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">108</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">109</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>    <span class="c1"># Stop the image acquisition of the camera side if in control mode.</span>
<span class="linenos">112</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_monitor</span><span class="p">:</span>
<span class="linenos">113</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">114</span>
<span class="linenos">115</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">116</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">117</span>
<span class="linenos">118</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">119</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-callback-class-py">
<h3>grab_callback_class.py<a class="headerlink" href="#grab-callback-class-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to use callback class function to acquire image data</span>
<span class="linenos"> 3</span><span class="sd"> from camera.</span>
<span class="linenos"> 4</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 5</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 6</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 7</span><span class="sd"> - Register and use callback class function with StApi</span>
<span class="linenos"> 8</span><span class="sd"> - Acquire image data via callback function</span>
<span class="linenos"> 9</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">12</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">class</span> <span class="nc">CMyCallback</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">16</span><span class="sd">    Class that contains a callback function.</span>
<span class="linenos">17</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">20</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">21</span><span class="sd">        Callback to handle events from DataStream.</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="sd">        :param handle: handle that trigger the callback.</span>
<span class="linenos">24</span><span class="sd">        :param context: user data passed on during callback registration.</span>
<span class="linenos">25</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">26</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos">27</span>        <span class="k">if</span> <span class="n">st_datastream</span><span class="p">:</span>
<span class="linenos">28</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">29</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">30</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">31</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">32</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">33</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">34</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">35</span>                          <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">36</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">37</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">38</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">39</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">40</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="c1"># Get the callback function:</span>
<span class="linenos">46</span>    <span class="n">my_callback</span> <span class="o">=</span> <span class="n">CMyCallback</span><span class="p">()</span>
<span class="linenos">47</span>    <span class="n">cb_func</span> <span class="o">=</span> <span class="n">my_callback</span><span class="o">.</span><span class="n">datastream_callback</span>
<span class="linenos">48</span>
<span class="linenos">49</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">50</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">51</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">52</span>
<span class="linenos">53</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">54</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">55</span>
<span class="linenos">56</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">57</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">58</span>
<span class="linenos">59</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">60</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">61</span>
<span class="linenos">62</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">63</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">64</span>
<span class="linenos">65</span>        <span class="c1"># Register callback for datastream</span>
<span class="linenos">66</span>        <span class="n">callback</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">cb_func</span><span class="p">)</span>
<span class="linenos">67</span>
<span class="linenos">68</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">69</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">70</span>
<span class="linenos">71</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">72</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">73</span>
<span class="linenos">74</span>        <span class="c1"># Press enter to terminate.</span>
<span class="linenos">75</span>        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to terminate&quot;</span><span class="p">)</span>
<span class="linenos">76</span>
<span class="linenos">77</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">78</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">79</span>
<span class="linenos">80</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">81</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">82</span>
<span class="linenos">83</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">84</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-callback-opencv-py">
<h3>grab_callback_opencv.py<a class="headerlink" href="#grab-callback-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use OpenCV for format conversion and display.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Register and use callback function with StApi</span>
<span class="linenos">  7</span><span class="sd"> - Acquire image data via callback class function</span>
<span class="linenos">  8</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos">  9</span><span class="sd"> - Convert Bayer image format to RGB using OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 11</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 12</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 13</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 14</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="linenos"> 18</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 19</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 22</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">class</span> <span class="nc">CMyCallback</span><span class="p">:</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 27</span><span class="sd">    Class that contains a callback function.</span>
<span class="linenos"> 28</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 31</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 32</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>    <span class="nd">@property</span>
<span class="linenos"> 35</span>    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 36</span>        <span class="n">duplicate</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 37</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="linenos"> 38</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 39</span>            <span class="n">duplicate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 40</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="linenos"> 41</span>        <span class="k">return</span> <span class="n">duplicate</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>    <span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 44</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 45</span><span class="sd">        Callback to handle events from DataStream.</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="sd">        :param handle: handle that trigger the callback.</span>
<span class="linenos"> 48</span><span class="sd">        :param context: user data passed on during callback registration.</span>
<span class="linenos"> 49</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 50</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos"> 51</span>        <span class="k">if</span> <span class="n">st_datastream</span><span class="p">:</span>
<span class="linenos"> 52</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 53</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 54</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 55</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos"> 56</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>                    <span class="c1"># Check the pixelformat of the input image.</span>
<span class="linenos"> 59</span>                    <span class="n">pixel_format</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">pixel_format</span>
<span class="linenos"> 60</span>                    <span class="n">pixel_format_info</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">get_pixel_format_info</span><span class="p">(</span><span class="n">pixel_format</span><span class="p">)</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span>                    <span class="c1"># Only mono or bayer is processed.</span>
<span class="linenos"> 63</span>                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_mono</span> <span class="ow">or</span>
<span class="linenos"> 64</span>                           <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">):</span>
<span class="linenos"> 65</span>                        <span class="k">return</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>                    <span class="c1"># Get raw image data.</span>
<span class="linenos"> 68</span>                    <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>                    <span class="c1"># Perform pixel value scaling if each pixel component is</span>
<span class="linenos"> 71</span>                    <span class="c1"># larger than 8bit. Example: 10bit Bayer/Mono, 12bit, etc.</span>
<span class="linenos"> 72</span>                    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">each_component_total_bit_count</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
<span class="linenos"> 73</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<span class="linenos"> 74</span>                        <span class="n">division</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pixel_format_info</span>
<span class="linenos"> 75</span>                                       <span class="o">.</span><span class="n">each_component_valid_bit_count</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
<span class="linenos"> 76</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="p">(</span><span class="n">nparr</span> <span class="o">/</span> <span class="n">division</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
<span class="linenos"> 77</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 78</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>                    <span class="c1"># Process image for display.</span>
<span class="linenos"> 81</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span>                    <span class="c1"># Perform color conversion for Bayer.</span>
<span class="linenos"> 84</span>                    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">:</span>
<span class="linenos"> 85</span>                        <span class="n">bayer_type</span> <span class="o">=</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">get_pixel_color_filter</span><span class="p">()</span>
<span class="linenos"> 86</span>                        <span class="k">if</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerRG</span><span class="p">:</span>
<span class="linenos"> 87</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_RG2RGB</span><span class="p">)</span>
<span class="linenos"> 88</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGR</span><span class="p">:</span>
<span class="linenos"> 89</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GR2RGB</span><span class="p">)</span>
<span class="linenos"> 90</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGB</span><span class="p">:</span>
<span class="linenos"> 91</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GB2RGB</span><span class="p">)</span>
<span class="linenos"> 92</span>                        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerBG</span><span class="p">:</span>
<span class="linenos"> 93</span>                            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_BG2RGB</span><span class="p">)</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>                    <span class="c1"># Resize image and store to self._image.</span>
<span class="linenos"> 96</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 97</span>                                       <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos"> 98</span>                                       <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos"> 99</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="linenos">100</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_image</span> <span class="o">=</span> <span class="n">nparr</span>
<span class="linenos">101</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="linenos">102</span>
<span class="linenos">103</span>
<span class="linenos">104</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">105</span>    <span class="n">my_callback</span> <span class="o">=</span> <span class="n">CMyCallback</span><span class="p">()</span>
<span class="linenos">106</span>    <span class="n">cb_func</span> <span class="o">=</span> <span class="n">my_callback</span><span class="o">.</span><span class="n">datastream_callback</span>
<span class="linenos">107</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">108</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">109</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">110</span>
<span class="linenos">111</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">112</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">113</span>
<span class="linenos">114</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">115</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">116</span>
<span class="linenos">117</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">118</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">119</span>
<span class="linenos">120</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">121</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">122</span>
<span class="linenos">123</span>        <span class="c1"># Register callback for datastream</span>
<span class="linenos">124</span>        <span class="n">callback</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">cb_func</span><span class="p">)</span>
<span class="linenos">125</span>
<span class="linenos">126</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">127</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">128</span>
<span class="linenos">129</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">130</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">131</span>
<span class="linenos">132</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To terminate, focus on the OpenCV window and press any key.&quot;</span><span class="p">)</span>
<span class="linenos">133</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">134</span>            <span class="n">output_image</span> <span class="o">=</span> <span class="n">my_callback</span><span class="o">.</span><span class="n">image</span>
<span class="linenos">135</span>            <span class="k">if</span> <span class="n">output_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">136</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">output_image</span><span class="p">)</span>
<span class="linenos">137</span>            <span class="n">key_input</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">138</span>            <span class="k">if</span> <span class="n">key_input</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">139</span>                <span class="k">break</span>
<span class="linenos">140</span>
<span class="linenos">141</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">142</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">143</span>
<span class="linenos">144</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">145</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">146</span>
<span class="linenos">147</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">148</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-callback-py">
<h3>grab_callback.py<a class="headerlink" href="#grab-callback-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to use callback function to acquire image data from camera.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 6</span><span class="sd"> - Register and use callback function with StApi</span>
<span class="linenos"> 7</span><span class="sd"> - Acquire image data via callback function</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">11</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">def</span> <span class="nf">datastream_callback</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">14</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">15</span><span class="sd">    Callback to handle events from DataStream.</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="sd">    :param handle: handle that trigger the callback.</span>
<span class="linenos">18</span><span class="sd">    :param context: user data passed on during callback registration.</span>
<span class="linenos">19</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">20</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos">21</span>    <span class="k">if</span> <span class="n">st_datastream</span><span class="p">:</span>
<span class="linenos">22</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">23</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">24</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">25</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">26</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">27</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">28</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">29</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">30</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">31</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">32</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">33</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">34</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">38</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">40</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">43</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">44</span>
<span class="linenos">45</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">46</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">47</span>
<span class="linenos">48</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">49</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">50</span>
<span class="linenos">51</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">52</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">53</span>
<span class="linenos">54</span>        <span class="c1"># Register callback for datastream</span>
<span class="linenos">55</span>        <span class="n">callback</span> <span class="o">=</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">datastream_callback</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">58</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">()</span>
<span class="linenos">59</span>
<span class="linenos">60</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">61</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">62</span>
<span class="linenos">63</span>        <span class="c1"># Press enter to terminate.</span>
<span class="linenos">64</span>        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to terminate&quot;</span><span class="p">)</span>
<span class="linenos">65</span>
<span class="linenos">66</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">67</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">68</span>
<span class="linenos">69</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">70</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">71</span>
<span class="linenos">72</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">73</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-camera-event-py">
<h3>grab_camera_event.py<a class="headerlink" href="#grab-camera-event-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to register an event callback with callback function.</span>
<span class="linenos">  3</span><span class="sd"> Here we register the callback function to &quot;ExposureEnd&quot; event (Defined as</span>
<span class="linenos">  4</span><span class="sd"> TARGET_EVENT_NAME) with a callback function to handle this event.</span>
<span class="linenos">  5</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  6</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  7</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  8</span><span class="sd"> - Acquire image data with callback function</span>
<span class="linenos">  9</span><span class="sd"> - Enable the event message sending function of camera</span>
<span class="linenos"> 10</span><span class="sd"> - Register callback function of indicated event</span>
<span class="linenos"> 11</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 16</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Feature names</span>
<span class="linenos"> 19</span><span class="n">EVENT_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;EventSelector&quot;</span>
<span class="linenos"> 20</span><span class="n">EVENT_NOTIFICATION</span> <span class="o">=</span> <span class="s2">&quot;EventNotification&quot;</span>
<span class="linenos"> 21</span><span class="n">EVENT_NOTIFICATION_ON</span> <span class="o">=</span> <span class="s2">&quot;On&quot;</span>
<span class="linenos"> 22</span><span class="n">TARGET_EVENT_NAME</span> <span class="o">=</span> <span class="s2">&quot;ExposureEnd&quot;</span>
<span class="linenos"> 23</span><span class="n">CALLBACK_NODE_NAME</span> <span class="o">=</span> <span class="s2">&quot;EventExposureEndTimestamp&quot;</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="k">def</span> <span class="nf">node_callback</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 27</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 28</span><span class="sd">    Callback to handle events from GenICam node.</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="sd">    :param node: node that trigger the callback.</span>
<span class="linenos"> 31</span><span class="sd">    :param context: user data passed on during callback registration.</span>
<span class="linenos"> 32</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 33</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 34</span>        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_readable</span><span class="p">:</span>
<span class="linenos"> 35</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="linenos"> 36</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 37</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not readable&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="linenos"> 38</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">my_exception</span><span class="p">:</span>
<span class="linenos"> 39</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node_callback&quot;</span><span class="p">,</span> <span class="n">my_exception</span><span class="p">)</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 46</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 49</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 52</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 55</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 58</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>        <span class="c1"># Get the nodemap object to access current setting of the camera.</span>
<span class="linenos"> 61</span>        <span class="n">st_nodemap_remote</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>        <span class="c1"># Get node of &quot;EventExposureEndTimestamp&quot; for event registration.</span>
<span class="linenos"> 64</span>        <span class="n">st_event_node</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">CALLBACK_NODE_NAME</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>        <span class="c1"># Register callback for EventExposureEndTimestamp.</span>
<span class="linenos"> 67</span>        <span class="n">st_event_node</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">node_callback</span><span class="p">)</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>        <span class="c1"># Get event selector.</span>
<span class="linenos"> 70</span>        <span class="n">st_event_selector</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">EVENT_SELECTOR</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 71</span>        <span class="c1"># As alternative of the above statement, it is also possible to</span>
<span class="linenos"> 72</span>        <span class="c1"># use the following statement to make the code easier to understand:</span>
<span class="linenos"> 73</span>        <span class="c1"># st_event_selector = st.PyIEnumeration(</span>
<span class="linenos"> 74</span>        <span class="c1">#                     st_nodemap_remote.get_node(EVENT_SELECTOR))</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>        <span class="c1"># Select the target event.</span>
<span class="linenos"> 77</span>        <span class="c1"># Note that depending on your use case, there are three ways to set</span>
<span class="linenos"> 78</span>        <span class="c1"># the enumeration value:</span>
<span class="linenos"> 79</span>        <span class="c1"># 1) Assign the integer value of the entry with set_int_value or .value</span>
<span class="linenos"> 80</span>        <span class="c1"># st_event_selector_entry = st_event_selector[TARGET_EVENT_NAME].get()</span>
<span class="linenos"> 81</span>        <span class="c1"># st_event_selector.set_int_value(st_event_selector_entry.numeric_value)</span>
<span class="linenos"> 82</span>        <span class="c1"># or: st_event_selector.value = st_event_selector_entry.numeric_value</span>
<span class="linenos"> 83</span>        <span class="c1"># 2) Assign the symbolic value of the entry with set_symbolic_value</span>
<span class="linenos"> 84</span>        <span class="c1"># st_event_selector.set_symbolic_value(TARGET_EVENT_NAME)</span>
<span class="linenos"> 85</span>        <span class="c1"># 3) Assign the entry (PyIEnumEntry) with set_entry_value</span>
<span class="linenos"> 86</span>        <span class="c1"># st_event_selector_entry = st_event_selector[TARGET_EVENT_NAME].get()</span>
<span class="linenos"> 87</span>        <span class="c1"># st_event_selector.set_entry_value(st_event_selector_entry)</span>
<span class="linenos"> 88</span>        <span class="c1"># Here we used 2) because we already know and sure the symbolic name.</span>
<span class="linenos"> 89</span>        <span class="n">st_event_selector</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">TARGET_EVENT_NAME</span><span class="p">)</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>        <span class="c1"># Enable event notification.</span>
<span class="linenos"> 92</span>        <span class="n">st_event_notification</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">st_nodemap_remote</span>
<span class="linenos"> 93</span>                                                  <span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">EVENT_NOTIFICATION</span><span class="p">))</span>
<span class="linenos"> 94</span>        <span class="n">st_event_notification</span><span class="o">.</span><span class="n">set_symbolic_value</span><span class="p">(</span><span class="n">EVENT_NOTIFICATION_ON</span><span class="p">)</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>        <span class="c1"># Start event handling thread</span>
<span class="linenos"> 97</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">start_event_acquisition</span><span class="p">()</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">100</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">101</span>
<span class="linenos">102</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">103</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">104</span>
<span class="linenos">105</span>        <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">106</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">107</span>            <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">108</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">109</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">110</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">111</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">112</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">113</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">114</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2"> &quot;</span>
<span class="linenos">115</span>                          <span class="s2">&quot;Timestamp=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">116</span>                              <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">117</span>                              <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">118</span>                              <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos">119</span>                              <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
<span class="linenos">120</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">121</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">122</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">125</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">126</span>
<span class="linenos">127</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">128</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">129</span>
<span class="linenos">130</span>        <span class="c1"># Stop event acquisition thread</span>
<span class="linenos">131</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">stop_event_acquisition</span><span class="p">()</span>
<span class="linenos">132</span>
<span class="linenos">133</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">134</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-chunk-image-py">
<h3>grab_chunk_image.py<a class="headerlink" href="#grab-chunk-image-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd">This sample shows the basic operation of using StApi and display chunk data</span>
<span class="linenos">  3</span><span class="sd">of the received image.</span>
<span class="linenos">  4</span><span class="sd">The following points will be demonstrated in this sample code:</span>
<span class="linenos">  5</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  6</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  7</span><span class="sd"> - Acquire and display chunk data.</span>
<span class="linenos">  8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 13</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="c1"># Flag to indicate if all chunks are enabled</span>
<span class="linenos"> 16</span><span class="n">enable_all_chunks</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Feature names</span>
<span class="linenos"> 19</span><span class="n">CHUNK_MODE_ACTIVE</span> <span class="o">=</span> <span class="s2">&quot;ChunkModeActive&quot;</span>
<span class="linenos"> 20</span><span class="n">CHUNK_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;ChunkSelector&quot;</span>
<span class="linenos"> 21</span><span class="n">CHUNK_ENABLE</span> <span class="o">=</span> <span class="s2">&quot;ChunkEnable&quot;</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="c1"># If enable_all_chunks is False, enable only the following chunk:</span>
<span class="linenos"> 24</span><span class="n">TARGET_CHUNK_NAME</span> <span class="o">=</span> <span class="s2">&quot;ExposureTime&quot;</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">def</span> <span class="nf">display_node_values</span><span class="p">(</span><span class="n">node_list</span><span class="p">):</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 29</span><span class="sd">    Display node values.</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="sd">    :param node_list: list of nodes to display.</span>
<span class="linenos"> 32</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 33</span>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
<span class="linenos"> 34</span>        <span class="n">node_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> \
<span class="linenos"> 35</span>            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_readable</span> <span class="k">else</span> <span class="s2">&quot;not readable&quot;</span>
<span class="linenos"> 36</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node_value</span><span class="p">))</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 42</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 43</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 46</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 49</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 52</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 55</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>        <span class="c1"># Get the nodemap object to access current setting of the camera.</span>
<span class="linenos"> 58</span>        <span class="n">st_nodemap_remote</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>        <span class="c1"># Get related node to access and activate chunk</span>
<span class="linenos"> 61</span>        <span class="n">st_chunk_mode_active</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">CHUNK_MODE_ACTIVE</span><span class="p">)</span>
<span class="linenos"> 62</span>        <span class="n">st_chunk_mode_active</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>        <span class="c1"># Get the PyIEnumeration of the chunk selector.</span>
<span class="linenos"> 65</span>        <span class="c1"># Here, .get() is used to shorten the code. To make the code more</span>
<span class="linenos"> 66</span>        <span class="c1"># understandable, casting can be used as well:</span>
<span class="linenos"> 67</span>        <span class="c1"># st_chunk_selector = \</span>
<span class="linenos"> 68</span>        <span class="c1">#   st.PyIEnumeration(st_nodemap_remote.get_node(CHUNK_SELECTOR))</span>
<span class="linenos"> 69</span>        <span class="n">st_chunk_selector</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">CHUNK_SELECTOR</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>        <span class="c1"># Get chunk enable.</span>
<span class="linenos"> 72</span>        <span class="n">st_chunk_enable</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">CHUNK_ENABLE</span><span class="p">)</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span>        <span class="n">st_chunk_value_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 75</span>        <span class="k">if</span> <span class="n">enable_all_chunks</span><span class="p">:</span>
<span class="linenos"> 76</span>            <span class="n">chunk_lists</span> <span class="o">=</span> <span class="n">st_chunk_selector</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos"> 77</span>            <span class="k">for</span> <span class="n">chunk_item</span> <span class="ow">in</span> <span class="n">chunk_lists</span><span class="p">:</span>
<span class="linenos"> 78</span>                <span class="c1"># Skip unavailable chunk.</span>
<span class="linenos"> 79</span>                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk_item</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 80</span>                    <span class="k">continue</span>
<span class="linenos"> 81</span>                <span class="c1"># Set selector to the chunk item and enable it.</span>
<span class="linenos"> 82</span>                <span class="n">st_chunk_selector</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">chunk_item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos"> 83</span>                <span class="k">if</span> <span class="n">st_chunk_enable</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 84</span>                    <span class="n">st_chunk_enable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>                <span class="c1"># Get the node for the value of the Chunk and put to list.</span>
<span class="linenos"> 87</span>                <span class="n">chunk_value</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos"> 88</span>                    <span class="s2">&quot;Chunk&quot;</span> <span class="o">+</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">chunk_item</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">)</span>
<span class="linenos"> 89</span>                <span class="k">if</span> <span class="n">chunk_value</span><span class="p">:</span>
<span class="linenos"> 90</span>                    <span class="n">st_chunk_value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_value</span><span class="p">)</span>
<span class="linenos"> 91</span>                    <span class="n">chunk_value</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 92</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 93</span>            <span class="c1"># Get the entry for the specified chunk.</span>
<span class="linenos"> 94</span>            <span class="n">chunk_item</span> <span class="o">=</span> <span class="n">st_chunk_selector</span><span class="p">[</span><span class="n">TARGET_CHUNK_NAME</span><span class="p">]</span>
<span class="linenos"> 95</span>            <span class="k">if</span> <span class="n">chunk_item</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 96</span>                <span class="c1"># Set the selector to the chunk and enable it.</span>
<span class="linenos"> 97</span>                <span class="n">st_chunk_selector</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">chunk_item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos"> 98</span>                <span class="k">if</span> <span class="n">st_chunk_enable</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 99</span>                    <span class="n">st_chunk_enable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">100</span>                <span class="c1"># Get the node for the value of the Chunk and put to list.</span>
<span class="linenos">101</span>                <span class="n">chunk_value</span> <span class="o">=</span> <span class="n">st_nodemap_remote</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">TARGET_CHUNK_NAME</span><span class="p">)</span>
<span class="linenos">102</span>                <span class="k">if</span> <span class="n">chunk_value</span><span class="p">:</span>
<span class="linenos">103</span>                    <span class="n">st_chunk_value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_value</span><span class="p">)</span>
<span class="linenos">104</span>                    <span class="n">chunk_value</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">105</span>
<span class="linenos">106</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">107</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">108</span>
<span class="linenos">109</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">110</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">111</span>
<span class="linenos">112</span>        <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">113</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">114</span>            <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">115</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">116</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">117</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">118</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">119</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">120</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">121</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2"> &quot;</span>
<span class="linenos">122</span>                          <span class="s2">&quot;Timestamp=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">123</span>                              <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">124</span>                              <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">125</span>                              <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos">126</span>                              <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
<span class="linenos">127</span>                    <span class="n">display_node_values</span><span class="p">(</span><span class="n">st_chunk_value_list</span><span class="p">)</span>
<span class="linenos">128</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">129</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">130</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">133</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">134</span>
<span class="linenos">135</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">136</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">137</span>
<span class="linenos">138</span>        <span class="c1"># Stop event acquisition thread</span>
<span class="linenos">139</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">stop_event_acquisition</span><span class="p">()</span>
<span class="linenos">140</span>
<span class="linenos">141</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">142</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-ip-opencv-py">
<h3>grab_ip_opencv.py<a class="headerlink" href="#grab-ip-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to use StApi with OpenCV for format conversion and display.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 6</span><span class="sd"> - Acquire image data</span>
<span class="linenos"> 7</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos"> 8</span><span class="sd"> - Convert Bayer image format to BGR8 using StApi IP</span>
<span class="linenos"> 9</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos">10</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos">11</span><span class="sd">    pip install numpy</span>
<span class="linenos">12</span><span class="sd">    pip install opencv-python</span>
<span class="linenos">13</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos">16</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">17</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="c1"># Number of images to grab</span>
<span class="linenos">20</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos">23</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">26</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">27</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="c1"># Initialize converter</span>
<span class="linenos">30</span>    <span class="n">st_converter</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_converter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStConverterType</span><span class="o">.</span><span class="n">PixelFormat</span><span class="p">)</span>
<span class="linenos">31</span>    <span class="n">st_converter</span><span class="o">.</span><span class="n">destination_pixel_format</span> <span class="o">=</span> \
<span class="linenos">32</span>        <span class="n">st</span><span class="o">.</span><span class="n">EStPixelFormatNamingConvention</span><span class="o">.</span><span class="n">BGR8</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">35</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos">38</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">41</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">44</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">47</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">48</span>
<span class="linenos">49</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">50</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">51</span>
<span class="linenos">52</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">53</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">54</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">55</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos">56</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos">57</span>        <span class="c1">#          properly.</span>
<span class="linenos">58</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">59</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">60</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">61</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">62</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">63</span>
<span class="linenos">64</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">65</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">66</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">67</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">68</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">69</span>
<span class="linenos">70</span>                <span class="c1"># Convert image and get the NumPy array.</span>
<span class="linenos">71</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">st_image</span><span class="p">)</span>
<span class="linenos">72</span>                <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos">73</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos">74</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos">75</span>
<span class="linenos">76</span>                <span class="c1"># Resize image.and display.</span>
<span class="linenos">77</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">78</span>                                   <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos">79</span>                                   <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos">80</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">nparr</span><span class="p">)</span>
<span class="linenos">81</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">82</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">83</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">84</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">85</span>
<span class="linenos">86</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">87</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">88</span>
<span class="linenos">89</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">90</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">91</span>
<span class="linenos">92</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">93</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-opencv-py">
<h3>grab_opencv.py<a class="headerlink" href="#grab-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use StApi with OpenCV for format conversion and display.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Acquire image data</span>
<span class="linenos">  7</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos">  8</span><span class="sd"> - Convert Bayer image format to RGB using OpenCV</span>
<span class="linenos">  9</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 11</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 12</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 13</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 16</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 20</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 23</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 26</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 27</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 30</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 33</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 36</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 39</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 42</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 45</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos"> 48</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 49</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos"> 50</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos"> 51</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos"> 52</span>        <span class="c1">#          properly.</span>
<span class="linenos"> 53</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 54</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 55</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 56</span>                <span class="c1"># Create an image object.</span>
<span class="linenos"> 57</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 60</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 61</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 62</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 63</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span>                <span class="c1"># Check the pixelformat of the input image.</span>
<span class="linenos"> 66</span>                <span class="n">pixel_format</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">pixel_format</span>
<span class="linenos"> 67</span>                <span class="n">pixel_format_info</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">get_pixel_format_info</span><span class="p">(</span><span class="n">pixel_format</span><span class="p">)</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>                <span class="c1"># Only mono or bayer is processed.</span>
<span class="linenos"> 70</span>                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_mono</span> <span class="ow">or</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">):</span>
<span class="linenos"> 71</span>                    <span class="k">continue</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>                <span class="c1"># Get raw image data.</span>
<span class="linenos"> 74</span>                <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>                <span class="c1"># Perform pixel value scaling if each pixel component is</span>
<span class="linenos"> 77</span>                <span class="c1"># larger than 8bit. Example: 10bit Bayer/Mono, 12bit, etc.</span>
<span class="linenos"> 78</span>                <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">each_component_total_bit_count</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
<span class="linenos"> 79</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<span class="linenos"> 80</span>                    <span class="n">division</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pixel_format_info</span>
<span class="linenos"> 81</span>                                   <span class="o">.</span><span class="n">each_component_valid_bit_count</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
<span class="linenos"> 82</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="p">(</span><span class="n">nparr</span> <span class="o">/</span> <span class="n">division</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
<span class="linenos"> 83</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 84</span>                    <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>                <span class="c1"># Process image for display.</span>
<span class="linenos"> 87</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span>                <span class="c1"># Perform color conversion for Bayer.</span>
<span class="linenos"> 90</span>                <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">:</span>
<span class="linenos"> 91</span>                    <span class="n">bayer_type</span> <span class="o">=</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">get_pixel_color_filter</span><span class="p">()</span>
<span class="linenos"> 92</span>                    <span class="k">if</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerRG</span><span class="p">:</span>
<span class="linenos"> 93</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_RG2RGB</span><span class="p">)</span>
<span class="linenos"> 94</span>                    <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGR</span><span class="p">:</span>
<span class="linenos"> 95</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GR2RGB</span><span class="p">)</span>
<span class="linenos"> 96</span>                    <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGB</span><span class="p">:</span>
<span class="linenos"> 97</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GB2RGB</span><span class="p">)</span>
<span class="linenos"> 98</span>                    <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerBG</span><span class="p">:</span>
<span class="linenos"> 99</span>                        <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_BG2RGB</span><span class="p">)</span>
<span class="linenos">100</span>
<span class="linenos">101</span>                <span class="c1"># Resize image.and display.</span>
<span class="linenos">102</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">103</span>                                   <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos">104</span>                                   <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos">105</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">nparr</span><span class="p">)</span>
<span class="linenos">106</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">107</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">108</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">109</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">112</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">113</span>
<span class="linenos">114</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">115</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">116</span>
<span class="linenos">117</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">118</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="grab-py">
<h3>grab.py<a class="headerlink" href="#grab-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows the basic operation of using StApi for connecting,</span>
<span class="linenos"> 3</span><span class="sd"> controlling, and acquiring image from camera.</span>
<span class="linenos"> 4</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 5</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 6</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 7</span><span class="sd"> - Acquire image data (with waiting in main thread)</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Number of images to grab</span>
<span class="linenos">13</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">17</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">20</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos">23</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">26</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">29</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">32</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">35</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">38</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">40</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos">41</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos">42</span>        <span class="c1">#          properly.</span>
<span class="linenos">43</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">44</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">45</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">46</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">47</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">48</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">49</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">50</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">51</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">52</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">53</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">54</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">55</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">58</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">59</span>
<span class="linenos">60</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">61</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">64</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="host-side-roi-opencv-py">
<h3>host_side_roi_opencv.py<a class="headerlink" href="#host-side-roi-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to divide image data into multiple ROI images in local</span>
<span class="linenos">  3</span><span class="sd"> side and display them using OpenCV.</span>
<span class="linenos">  4</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  5</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  6</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  7</span><span class="sd"> - Acquire image</span>
<span class="linenos">  8</span><span class="sd"> - Process image ROI in host side (local computer)</span>
<span class="linenos">  9</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> - Convert Bayer image format to RGB using OpenCV</span>
<span class="linenos"> 11</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 12</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 13</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 14</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 15</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 18</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 19</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 22</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 25</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="c1"># Regions of each direction.</span>
<span class="linenos"> 28</span><span class="n">HORIZONTAL_ROI_COUNT</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos"> 29</span><span class="n">VERTICAL_ROI_COUNT</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="k">def</span> <span class="nf">display_with_opencv</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">pixel_format_info</span><span class="p">):</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 34</span><span class="sd">    Function to convert PyIStImage pixel format and display it using OpenCV.</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="sd">    :param img: Image to process</span>
<span class="linenos"> 37</span><span class="sd">    :param pixel_format_info: Pixel format info.</span>
<span class="linenos"> 38</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 39</span>    <span class="c1"># Get raw image data.</span>
<span class="linenos"> 40</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span>    <span class="c1"># Perform pixel value scaling if each pixel component is</span>
<span class="linenos"> 43</span>    <span class="c1"># larger than 8bit. Example: 10bit Bayer/Mono, 12bit, etc.</span>
<span class="linenos"> 44</span>    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">each_component_total_bit_count</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
<span class="linenos"> 45</span>        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<span class="linenos"> 46</span>        <span class="n">division</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pixel_format_info</span>
<span class="linenos"> 47</span>                       <span class="o">.</span><span class="n">each_component_valid_bit_count</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
<span class="linenos"> 48</span>        <span class="n">nparr</span> <span class="o">=</span> <span class="p">(</span><span class="n">nparr</span> <span class="o">/</span> <span class="n">division</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
<span class="linenos"> 49</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 50</span>        <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>    <span class="c1"># Process image for display.</span>
<span class="linenos"> 53</span>    <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="c1"># Perform color conversion for Bayer.</span>
<span class="linenos"> 56</span>    <span class="k">if</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">:</span>
<span class="linenos"> 57</span>        <span class="n">bayer_type</span> <span class="o">=</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">get_pixel_color_filter</span><span class="p">()</span>
<span class="linenos"> 58</span>        <span class="k">if</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerRG</span><span class="p">:</span>
<span class="linenos"> 59</span>            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_RG2RGB</span><span class="p">)</span>
<span class="linenos"> 60</span>        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGR</span><span class="p">:</span>
<span class="linenos"> 61</span>            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GR2RGB</span><span class="p">)</span>
<span class="linenos"> 62</span>        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerGB</span><span class="p">:</span>
<span class="linenos"> 63</span>            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_GB2RGB</span><span class="p">)</span>
<span class="linenos"> 64</span>        <span class="k">elif</span> <span class="n">bayer_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStPixelColorFilter</span><span class="o">.</span><span class="n">BayerBG</span><span class="p">:</span>
<span class="linenos"> 65</span>            <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BAYER_BG2RGB</span><span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>    <span class="c1"># Resize image and display.</span>
<span class="linenos"> 68</span>    <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 69</span>                       <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos"> 70</span>                       <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos"> 71</span>    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span> <span class="n">nparr</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 75</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 76</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 77</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 80</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 83</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 86</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 89</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>        <span class="c1"># Get the device nodemap to access the device settings.</span>
<span class="linenos"> 92</span>        <span class="n">remote_nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>        <span class="c1"># Get current setting of the image size.</span>
<span class="linenos"> 95</span>        <span class="n">image_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Width&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="linenos"> 96</span>                      <span class="n">remote_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;Height&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>        <span class="c1"># Get current pixel format information.</span>
<span class="linenos"> 99</span>        <span class="n">pixel_format</span> <span class="o">=</span> <span class="n">remote_nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;PixelFormat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">100</span>        <span class="n">pixel_format_info</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">get_pixel_format_info</span><span class="p">(</span><span class="n">pixel_format</span><span class="p">)</span>
<span class="linenos">101</span>
<span class="linenos">102</span>        <span class="c1"># Get the minimum setting unit of both sides (X and Y).</span>
<span class="linenos">103</span>        <span class="n">pixel_increment</span> <span class="o">=</span> <span class="p">[</span><span class="n">pixel_format_info</span><span class="o">.</span><span class="n">pixel_increment_x</span><span class="p">,</span>
<span class="linenos">104</span>                           <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">pixel_increment_y</span><span class="p">]</span>
<span class="linenos">105</span>
<span class="linenos">106</span>        <span class="c1"># Calculate the size of the ROI.</span>
<span class="linenos">107</span>        <span class="n">roi_window_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">HORIZONTAL_ROI_COUNT</span><span class="p">,</span> <span class="n">VERTICAL_ROI_COUNT</span><span class="p">]</span>
<span class="linenos">108</span>        <span class="n">roi_image_size</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">109</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<span class="linenos">110</span>            <span class="n">size</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">//</span> <span class="n">roi_window_count</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos">111</span>            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="n">pixel_increment</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
<span class="linenos">112</span>            <span class="n">roi_image_size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="linenos">113</span>
<span class="linenos">114</span>        <span class="c1"># Prepare display window</span>
<span class="linenos">115</span>        <span class="k">for</span> <span class="n">pos_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">roi_window_count</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<span class="linenos">116</span>            <span class="k">for</span> <span class="n">pos_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">roi_window_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos">117</span>                <span class="n">window_title</span> <span class="o">=</span> <span class="s2">&quot;image_</span><span class="si">{0}{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos_y</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">)</span>
<span class="linenos">118</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">WINDOW_NORMAL</span><span class="p">)</span>
<span class="linenos">119</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">moveWindow</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span>
<span class="linenos">120</span>                    <span class="nb">int</span><span class="p">(</span><span class="n">pos_x</span> <span class="o">*</span> <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">),</span>
<span class="linenos">121</span>                    <span class="nb">int</span><span class="p">(</span><span class="n">pos_y</span> <span class="o">*</span> <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">))</span>
<span class="linenos">122</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">resizeWindow</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span>
<span class="linenos">123</span>                    <span class="nb">int</span><span class="p">(</span><span class="n">roi_image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">),</span>
<span class="linenos">124</span>                    <span class="nb">int</span><span class="p">(</span><span class="n">roi_image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">))</span>
<span class="linenos">125</span>
<span class="linenos">126</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos">127</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">128</span>
<span class="linenos">129</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">130</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">131</span>
<span class="linenos">132</span>        <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">133</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">134</span>            <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos">135</span>            <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos">136</span>            <span class="c1"># assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos">137</span>            <span class="c1"># properly.</span>
<span class="linenos">138</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">139</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">140</span>                <span class="k">if</span> <span class="ow">not</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">141</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">142</span>                    <span class="k">continue</span>
<span class="linenos">143</span>
<span class="linenos">144</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">145</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">146</span>
<span class="linenos">147</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">148</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2">[fps]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">149</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">150</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">151</span>                      <span class="n">st_datastream</span><span class="o">.</span><span class="n">current_fps</span><span class="p">))</span>
<span class="linenos">152</span>
<span class="linenos">153</span>                <span class="c1"># Only mono or bayer is processed.</span>
<span class="linenos">154</span>                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_mono</span> <span class="ow">or</span> <span class="n">pixel_format_info</span><span class="o">.</span><span class="n">is_bayer</span><span class="p">):</span>
<span class="linenos">155</span>                    <span class="k">continue</span>
<span class="linenos">156</span>
<span class="linenos">157</span>                <span class="c1"># Display image.</span>
<span class="linenos">158</span>                <span class="n">display_with_opencv</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">st_image</span><span class="p">,</span> <span class="n">pixel_format_info</span><span class="p">)</span>
<span class="linenos">159</span>
<span class="linenos">160</span>                <span class="c1"># Process and display each ROI image.</span>
<span class="linenos">161</span>                <span class="k">for</span> <span class="n">pos_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">roi_window_count</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<span class="linenos">162</span>                    <span class="k">for</span> <span class="n">pos_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">roi_window_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos">163</span>                        <span class="n">roi_image</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_roi_image</span><span class="p">(</span>
<span class="linenos">164</span>                            <span class="n">pos_x</span> <span class="o">*</span> <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos">165</span>                            <span class="n">pos_y</span> <span class="o">*</span> <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="linenos">166</span>                            <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos">167</span>                            <span class="n">roi_image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">168</span>                        <span class="n">window_title</span> <span class="o">=</span> <span class="s2">&quot;image_</span><span class="si">{0}{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos_y</span><span class="p">,</span> <span class="n">pos_x</span><span class="p">)</span>
<span class="linenos">169</span>                        <span class="n">display_with_opencv</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span>
<span class="linenos">170</span>                                            <span class="n">roi_image</span><span class="p">,</span> <span class="n">pixel_format_info</span><span class="p">)</span>
<span class="linenos">171</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">172</span>
<span class="linenos">173</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">174</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">175</span>
<span class="linenos">176</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">177</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">178</span>
<span class="linenos">179</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">180</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multiple-cameras-py">
<h3>multiple_cameras.py<a class="headerlink" href="#multiple-cameras-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to conect and get images from all available cameras.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to all available cameras</span>
<span class="linenos"> 6</span><span class="sd"> - Acquire image from the list of camera</span>
<span class="linenos"> 7</span><span class="sd"> You can see how to handle multiple cameras/stream objects in this sample.</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Number of images to grab</span>
<span class="linenos">13</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">10</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">17</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">20</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="c1"># Create a camera device list object to store all the cameras.</span>
<span class="linenos">23</span>    <span class="n">device_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStDeviceList</span><span class="p">()</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Create a DataStream list object to store all the data stream object related to the cameras.</span>
<span class="linenos">26</span>    <span class="n">stream_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStDataStreamList</span><span class="p">()</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">29</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">30</span>            <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">31</span>        <span class="k">except</span><span class="p">:</span>
<span class="linenos">32</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">device_list</span><span class="p">:</span>
<span class="linenos">33</span>                <span class="k">raise</span>
<span class="linenos">34</span>            <span class="k">break</span>
<span class="linenos">35</span>        <span class="c1"># Add the camera into device object list for later usage.</span>
<span class="linenos">36</span>        <span class="n">device_list</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">st_device</span><span class="p">)</span>
<span class="linenos">37</span>
<span class="linenos">38</span>        <span class="c1"># Display the DisplayName of the device.</span>
<span class="linenos">39</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">device_list</span><span class="p">),</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">))</span>
<span class="linenos">40</span>
<span class="linenos">41</span>        <span class="c1"># Create a DataStream object then add into DataStream list for later usage.</span>
<span class="linenos">42</span>        <span class="n">stream_list</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    <span class="c1"># Start the image acquisition of the host side.</span>
<span class="linenos">45</span>    <span class="n">stream_list</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">48</span>    <span class="n">device_list</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">49</span>
<span class="linenos">50</span>    <span class="c1"># Loop for aquiring data and checking status</span>
<span class="linenos">51</span>    <span class="k">while</span> <span class="n">stream_list</span><span class="o">.</span><span class="n">is_grabbing_any</span><span class="p">:</span>
<span class="linenos">52</span>        <span class="c1"># Retrieve data buffer of image data from any camera with a timeout of 5000ms.</span>
<span class="linenos">53</span>        <span class="k">with</span> <span class="n">stream_list</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">54</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">55</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">56</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : BlockID=</span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2:.2f}</span><span class="s2">FPS&quot;</span>\
<span class="linenos">57</span>                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">st_buffer</span><span class="o">.</span><span class="n">datastream</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span>
<span class="linenos">58</span>                            <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">59</span>                            <span class="n">st_buffer</span><span class="o">.</span><span class="n">datastream</span><span class="o">.</span><span class="n">current_fps</span><span class="p">))</span>
<span class="linenos">60</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">61</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="c1"># Stop the image acquisition of the camera side.</span>
<span class="linenos">64</span>    <span class="n">device_list</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">65</span>
<span class="linenos">66</span>    <span class="c1"># Stop the image acquisition of the host side.</span>
<span class="linenos">67</span>    <span class="n">stream_list</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">68</span>
<span class="linenos">69</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">70</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
<span class="linenos">71</span><span class="k">finally</span><span class="p">:</span>
<span class="linenos">72</span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to terminate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multiple-systems-py">
<h3>multiple_systems.py<a class="headerlink" href="#multiple-systems-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to use multiple GenTL modules (cti files) for acquiring image data.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to the first detected camera of all system</span>
<span class="linenos"> 6</span><span class="sd"> - Acquire image data (with waiting in main thread) </span>
<span class="linenos"> 7</span><span class="sd"> - Use multiple GenTL module.</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Number of images to grab</span>
<span class="linenos">13</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">17</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Create a system object list for store system object.</span>
<span class="linenos">20</span>    <span class="c1"># Then we try to create objects of all available systems.</span>
<span class="linenos">21</span>    <span class="n">system_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStSystemList</span><span class="p">()</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">for</span> <span class="n">system_vendor</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">EStSystemVendor</span><span class="p">:</span>
<span class="linenos">24</span>        <span class="k">if</span> <span class="n">system_vendor</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStSystemVendor</span><span class="o">.</span><span class="n">Count</span><span class="p">:</span>
<span class="linenos">25</span>            <span class="k">continue</span>
<span class="linenos">26</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">27</span>            <span class="c1"># For each available system, </span>
<span class="linenos">28</span>            <span class="c1"># try to create object for it then register it into system list for further usage.</span>
<span class="linenos">29</span>            <span class="n">system_list</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">(</span><span class="n">system_vendor</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">EStInterfaceType</span><span class="o">.</span><span class="n">All</span><span class="p">))</span>
<span class="linenos">30</span>        <span class="k">except</span> <span class="n">st</span><span class="o">.</span><span class="n">PyStError</span> <span class="k">as</span> <span class="n">st_error</span><span class="p">:</span>
<span class="linenos">31</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An exception occurred.&quot;</span><span class="p">,</span> <span class="n">st_error</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="c1"># Create a device object of the first detected device to connect.</span>
<span class="linenos">34</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">system_list</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">ETLDeviceAccessFlags</span><span class="o">.</span><span class="n">AccessExclusive</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">37</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos">40</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span>    <span class="c1"># Start the image acquisition of the host side.</span>
<span class="linenos">43</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos">46</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos">47</span>
<span class="linenos">48</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos">49</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos">50</span>        <span class="c1"># Retrieve the buffer of image data with a timeout of 5000ms.</span>
<span class="linenos">51</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">52</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">53</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">54</span>                <span class="c1"># Create an image object.</span>
<span class="linenos">55</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">56</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">57</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">58</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">59</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">60</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">61</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">62</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">63</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">66</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">67</span>
<span class="linenos">68</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">69</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">72</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
<span class="linenos">73</span><span class="k">finally</span><span class="p">:</span>
<span class="linenos">74</span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press enter to terminate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-and-load-image-py">
<h3>save_and_load_image.py<a class="headerlink" href="#save-and-load-image-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to save a captured image into RAW file of StApi.</span>
<span class="linenos">  3</span><span class="sd"> After saving to RAW file, this sample will load the file,</span>
<span class="linenos">  4</span><span class="sd"> convert it to BGR8 image, and save as BMP/TIF/PNG/JPG files.</span>
<span class="linenos">  5</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  6</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  7</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  8</span><span class="sd"> - Acquire 1 image data</span>
<span class="linenos">  9</span><span class="sd"> - Save image to / Load image from file from temp folder</span>
<span class="linenos"> 10</span><span class="sd"> - Apply Pixel format conversion</span>
<span class="linenos"> 11</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 14</span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 19</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 22</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 23</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 26</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 29</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 32</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>    <span class="c1"># File for image file</span>
<span class="linenos"> 35</span>    <span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span>
<span class="linenos"> 36</span>    <span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
<span class="linenos"> 37</span>                                 <span class="n">filename_prefix</span> <span class="o">+</span> <span class="s2">&quot;.StApiRaw&quot;</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 40</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 43</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 46</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>    <span class="n">is_image_saved</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 49</span>    <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 50</span>        <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 51</span>        <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 52</span>            <span class="c1"># Create an image object.</span>
<span class="linenos"> 53</span>            <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos"> 54</span>            <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 55</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 56</span>                  <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 57</span>                  <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 58</span>                  <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>            <span class="c1"># Create a still image file handling class object (filer)</span>
<span class="linenos"> 61</span>            <span class="n">st_stillimage_filer</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_filer</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStFilerType</span><span class="o">.</span><span class="n">StillImage</span><span class="p">)</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>            <span class="c1"># Save the image file as StApiRaw file format.</span>
<span class="linenos"> 64</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving </span><span class="si">{0}</span><span class="s2"> ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_location</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos"> 65</span>            <span class="n">st_stillimage_filer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">st_image</span><span class="p">,</span>
<span class="linenos"> 66</span>                <span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">StApiRaw</span><span class="p">,</span> <span class="n">file_location</span><span class="p">)</span>
<span class="linenos"> 67</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done.&quot;</span><span class="p">)</span>
<span class="linenos"> 68</span>            <span class="n">is_image_saved</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 69</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 70</span>            <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos"> 71</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos"> 74</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos"> 77</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>    <span class="c1"># Load StapiRaw and process the image.</span>
<span class="linenos"> 80</span>    <span class="k">if</span> <span class="n">is_image_saved</span><span class="p">:</span>
<span class="linenos"> 81</span>        <span class="c1"># Load image</span>
<span class="linenos"> 82</span>        <span class="n">st_stillimage_filer</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_filer</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStFilerType</span><span class="o">.</span><span class="n">StillImage</span><span class="p">)</span>
<span class="linenos"> 83</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading </span><span class="si">{0}</span><span class="s2"> ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_location</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos"> 84</span>        <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_stillimage_filer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
<span class="linenos"> 85</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done.&quot;</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>        <span class="c1"># Convert image to BGR8 format.</span>
<span class="linenos"> 88</span>        <span class="n">st_converter</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_converter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStConverterType</span><span class="o">.</span><span class="n">PixelFormat</span><span class="p">)</span>
<span class="linenos"> 89</span>        <span class="n">st_converter</span><span class="o">.</span><span class="n">destination_pixel_format</span> <span class="o">=</span> \
<span class="linenos"> 90</span>            <span class="n">st</span><span class="o">.</span><span class="n">EStPixelFormatNamingConvention</span><span class="o">.</span><span class="n">BGR8</span>
<span class="linenos"> 91</span>        <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">st_image</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>        <span class="c1"># Save as bitmap, tiff, png, jpg, csv</span>
<span class="linenos"> 94</span>        <span class="n">save_list</span> <span class="o">=</span> <span class="p">{</span><span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">:</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span>
<span class="linenos"> 95</span>                     <span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">TIFF</span><span class="p">:</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span>
<span class="linenos"> 96</span>                     <span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">PNG</span><span class="p">:</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
<span class="linenos"> 97</span>                     <span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">JPEG</span><span class="p">:</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span>
<span class="linenos"> 98</span>                     <span class="n">st</span><span class="o">.</span><span class="n">EStStillImageFileFormat</span><span class="o">.</span><span class="n">CSV</span><span class="p">:</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span>
<span class="linenos"> 99</span>        <span class="p">}</span>
<span class="linenos">100</span>        <span class="k">for</span> <span class="n">file_format</span><span class="p">,</span> <span class="n">file_ext</span> <span class="ow">in</span> <span class="n">save_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">101</span>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
<span class="linenos">102</span>                <span class="n">filename_prefix</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">)</span>
<span class="linenos">103</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving </span><span class="si">{0}</span><span class="s2"> ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_location</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">104</span>            <span class="n">st_stillimage_filer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">st_image</span><span class="p">,</span> <span class="n">file_format</span><span class="p">,</span> <span class="n">file_location</span><span class="p">)</span>
<span class="linenos">105</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done.&quot;</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">108</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-load-features-py">
<h3>save_load_features.py<a class="headerlink" href="#save-load-features-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to save/load camera setting with using featureBag.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 6</span><span class="sd"> - Save/load camera setting to/from file</span>
<span class="linenos"> 7</span><span class="sd"> - Apply the loaded setting to camera</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos">11</span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">17</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">20</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos">23</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">26</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="s2">&quot;features.cfg&quot;</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="c1"># Get the remote nodemap.</span>
<span class="linenos">31</span>    <span class="n">nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="c1"># Create feature bag object.</span>
<span class="linenos">34</span>    <span class="n">featurebag</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_featurebag</span><span class="p">()</span>
<span class="linenos">35</span>    <span class="n">featurebag</span><span class="o">.</span><span class="n">store_nodemap_to_bag</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Display all settings.</span>
<span class="linenos">38</span>    <span class="n">features</span> <span class="o">=</span> <span class="n">featurebag</span><span class="o">.</span><span class="n">save_to_string</span><span class="p">()</span>
<span class="linenos">39</span>    <span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="c1"># Save settings in the feature bag to file.</span>
<span class="linenos">42</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="linenos">43</span>    <span class="n">featurebag</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="linenos">44</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving done&quot;</span><span class="p">)</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="c1"># Create another feature bag for loading setting from file.</span>
<span class="linenos">47</span>    <span class="n">featurebag2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_featurebag</span><span class="p">()</span>
<span class="linenos">48</span>
<span class="linenos">49</span>    <span class="c1"># Load the setting from file created above to the feature bag</span>
<span class="linenos">50</span>    <span class="n">featurebag2</span><span class="o">.</span><span class="n">store_file_to_bag</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="linenos">51</span>
<span class="linenos">52</span>    <span class="c1"># Load the setting from the feature bag to camera</span>
<span class="linenos">53</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading to camera..&quot;</span><span class="p">)</span>
<span class="linenos">54</span>    <span class="n">featurebag2</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">55</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading to camera done&quot;</span><span class="p">)</span>
<span class="linenos">56</span>
<span class="linenos">57</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">58</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-video-py">
<h3>save_video.py<a class="headerlink" href="#save-video-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to save acquired image as AVI video file.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Create AVI video file</span>
<span class="linenos">  7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 10</span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 13</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 16</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">10</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="c1"># Maximum number of frames in one video file</span>
<span class="linenos"> 19</span><span class="n">maximum_frame_count_per_file</span> <span class="o">=</span> <span class="mi">5</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="c1"># Number of video files</span>
<span class="linenos"> 22</span><span class="n">video_files_count</span> <span class="o">=</span> <span class="mi">3</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">def</span> <span class="nf">videofiler_callback</span><span class="p">(</span><span class="n">handle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 27</span><span class="sd">    Callback to handle events from Video Filer.</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="sd">    :param handle: handle that trigger the callback.</span>
<span class="linenos"> 30</span><span class="sd">    :param context: user data passed on during callback registration.</span>
<span class="linenos"> 31</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 32</span>    <span class="n">callback_type</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">callback_type</span>
<span class="linenos"> 33</span>    <span class="n">videofiler</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">module</span>
<span class="linenos"> 34</span>    <span class="k">if</span> <span class="n">callback_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStCallbackType</span><span class="o">.</span><span class="n">StApiIPVideoFilerOpen</span><span class="p">:</span>
<span class="linenos"> 35</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Open:&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
<span class="linenos"> 36</span>    <span class="k">elif</span> <span class="n">callback_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStCallbackType</span><span class="o">.</span><span class="n">StApiIPVideoFilerClose</span><span class="p">:</span>
<span class="linenos"> 37</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Close:&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
<span class="linenos"> 38</span>    <span class="k">elif</span> <span class="n">callback_type</span> <span class="o">==</span> <span class="n">st</span><span class="o">.</span><span class="n">EStCallbackType</span><span class="o">.</span><span class="n">StApiIPVideoFilerError</span><span class="p">:</span>
<span class="linenos"> 39</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos"> 40</span>        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 44</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 45</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 46</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 49</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 52</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 55</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>        <span class="c1"># Get the acquisition fps of the camera.</span>
<span class="linenos"> 58</span>        <span class="n">fps</span> <span class="o">=</span> <span class="mf">60.0</span>
<span class="linenos"> 59</span>        <span class="n">acquisition_frame_rate</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span>
<span class="linenos"> 60</span>            <span class="s2">&quot;AcquisitionFrameRate&quot;</span><span class="p">)</span>
<span class="linenos"> 61</span>        <span class="k">if</span> <span class="n">acquisition_frame_rate</span><span class="p">:</span>
<span class="linenos"> 62</span>            <span class="n">fps</span> <span class="o">=</span> <span class="n">acquisition_frame_rate</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>        <span class="c1"># Create PyStVideoFiler</span>
<span class="linenos"> 65</span>        <span class="n">st_videofiler</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_filer</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStFilerType</span><span class="o">.</span><span class="n">Video</span><span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>        <span class="c1"># Register a callback function.</span>
<span class="linenos"> 68</span>        <span class="n">callback_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="linenos"> 69</span>        <span class="n">videofiler_cb</span> <span class="o">=</span> <span class="n">st_videofiler</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">videofiler_callback</span><span class="p">,</span>
<span class="linenos"> 70</span>                                                        <span class="n">callback_info</span><span class="p">)</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>        <span class="c1"># Configure the video file settings.</span>
<span class="linenos"> 73</span>        <span class="n">st_videofiler</span><span class="o">.</span><span class="n">maximum_frame_count_per_file</span> <span class="o">=</span> \
<span class="linenos"> 74</span>            <span class="n">maximum_frame_count_per_file</span>
<span class="linenos"> 75</span>        <span class="n">st_videofiler</span><span class="o">.</span><span class="n">video_file_format</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">EStVideoFileFormat</span><span class="o">.</span><span class="n">AVI2</span>
<span class="linenos"> 76</span>        <span class="n">st_videofiler</span><span class="o">.</span><span class="n">video_file_compression</span> <span class="o">=</span> \
<span class="linenos"> 77</span>            <span class="n">st</span><span class="o">.</span><span class="n">EStVideoFileCompression</span><span class="o">.</span><span class="n">MotionJPEG</span>
<span class="linenos"> 78</span>        <span class="n">st_videofiler</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>        <span class="c1"># Register video files</span>
<span class="linenos"> 81</span>        <span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span>
<span class="linenos"> 82</span>        <span class="k">for</span> <span class="n">file_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">video_files_count</span><span class="p">):</span>
<span class="linenos"> 83</span>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
<span class="linenos"> 84</span>                                     <span class="n">filename_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.avi&quot;</span><span class="p">)</span>
<span class="linenos"> 85</span>            <span class="n">st_videofiler</span><span class="o">.</span><span class="n">register_filename</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>        <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 88</span>        <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>        <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 91</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>        <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 94</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>        <span class="n">first_frame</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 97</span>        <span class="n">first_timestamp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 98</span>        <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>            <span class="k">if</span> <span class="n">callback_info</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
<span class="linenos">101</span>                <span class="k">break</span>
<span class="linenos">102</span>            <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos">103</span>                <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos">104</span>                <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos">105</span>                    <span class="c1"># Create an image object.</span>
<span class="linenos">106</span>                    <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<span class="linenos">107</span>                    <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos">108</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3:.2f}</span><span class="s2"> fps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">109</span>                          <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos">110</span>                          <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos">111</span>                          <span class="n">st_datastream</span><span class="o">.</span><span class="n">current_fps</span><span class="p">))</span>
<span class="linenos">112</span>
<span class="linenos">113</span>                    <span class="c1"># Calculate frame number in case of frame drop.</span>
<span class="linenos">114</span>                    <span class="n">frame_no</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">115</span>                    <span class="n">current_timestamp</span> <span class="o">=</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">timestamp</span>
<span class="linenos">116</span>                    <span class="k">if</span> <span class="n">first_frame</span><span class="p">:</span>
<span class="linenos">117</span>                        <span class="n">first_frame</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">118</span>                        <span class="n">first_timestamp</span> <span class="o">=</span> <span class="n">current_timestamp</span>
<span class="linenos">119</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">120</span>                        <span class="n">delta</span> <span class="o">=</span> <span class="n">current_timestamp</span> <span class="o">-</span> <span class="n">first_timestamp</span>
<span class="linenos">121</span>                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">fps</span> <span class="o">/</span> <span class="mf">1000000000.0</span>
<span class="linenos">122</span>                        <span class="n">frame_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span>                    <span class="c1"># Add the image data to video file.</span>
<span class="linenos">125</span>                    <span class="n">st_videofiler</span><span class="o">.</span><span class="n">register_image</span><span class="p">(</span><span class="n">st_image</span><span class="p">,</span> <span class="n">frame_no</span><span class="p">)</span>
<span class="linenos">126</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">127</span>                    <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos">128</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos">129</span>
<span class="linenos">130</span>        <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos">131</span>        <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos">132</span>
<span class="linenos">133</span>        <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos">134</span>        <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos">135</span>
<span class="linenos">136</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">137</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="singleconverter-opencv-py">
<h3>singleconverter_opencv.py<a class="headerlink" href="#singleconverter-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd">This sample shows how to process received image with converter.</span>
<span class="linenos">  3</span><span class="sd">The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Acquire image data</span>
<span class="linenos">  7</span><span class="sd"> - Apply image processing with StApi converter (reverse Y and pixel format BGR8)</span>
<span class="linenos">  8</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos">  9</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 11</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 12</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 13</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 16</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 20</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 23</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 26</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 27</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 30</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 33</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 36</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>    <span class="c1"># Create a converter object for vertical reverse.</span>
<span class="linenos"> 39</span>    <span class="n">st_converter_reverse</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_converter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStConverterType</span><span class="o">.</span><span class="n">Reverse</span><span class="p">)</span>
<span class="linenos"> 40</span>    <span class="n">st_converter_reverse</span><span class="o">.</span><span class="n">reverse_y</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span>    <span class="c1"># Create a converter object for converting pixel format to BGR8.</span>
<span class="linenos"> 43</span>    <span class="n">st_converter_pixelformat</span> <span class="o">=</span> \
<span class="linenos"> 44</span>        <span class="n">st</span><span class="o">.</span><span class="n">create_converter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStConverterType</span><span class="o">.</span><span class="n">PixelFormat</span><span class="p">)</span>
<span class="linenos"> 45</span>    <span class="n">st_converter_pixelformat</span><span class="o">.</span><span class="n">destination_pixel_format</span> <span class="o">=</span> \
<span class="linenos"> 46</span>        <span class="n">st</span><span class="o">.</span><span class="n">EStPixelFormatNamingConvention</span><span class="o">.</span><span class="n">BGR8</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 49</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 52</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 55</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos"> 58</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 59</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos"> 60</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos"> 61</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos"> 62</span>        <span class="c1">#          properly.</span>
<span class="linenos"> 63</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 64</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 65</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 66</span>                <span class="c1"># Create an image object and convert</span>
<span class="linenos"> 67</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_converter_pixelformat</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
<span class="linenos"> 68</span>                    <span class="n">st_converter_reverse</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">()))</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 71</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 72</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 73</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 74</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>                <span class="c1"># Get raw image data.</span>
<span class="linenos"> 77</span>                <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>                <span class="c1"># Process image for displaying the BGR8 image.</span>
<span class="linenos"> 82</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>                <span class="c1"># Resize image.and display.</span>
<span class="linenos"> 85</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 86</span>                                   <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos"> 87</span>                                   <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos"> 88</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">nparr</span><span class="p">)</span>
<span class="linenos"> 89</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 90</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 91</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos"> 92</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos"> 95</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos"> 98</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">101</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="singlefilter-opencv-py">
<h3>singlefilter_opencv.py<a class="headerlink" href="#singlefilter-opencv-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd">This sample shows how to process received image with filter and converter.</span>
<span class="linenos">  3</span><span class="sd">The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Acquire image data</span>
<span class="linenos">  7</span><span class="sd"> - Apply image processing with StApi filter and converter.</span>
<span class="linenos">  8</span><span class="sd"> - Copy image data for OpenCV</span>
<span class="linenos">  9</span><span class="sd"> - Preview image using OpenCV</span>
<span class="linenos"> 10</span><span class="sd"> Note: opencv-python and numpy packages are required:</span>
<span class="linenos"> 11</span><span class="sd">    pip install numpy</span>
<span class="linenos"> 12</span><span class="sd">    pip install opencv-python</span>
<span class="linenos"> 13</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="linenos"> 16</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="c1"># Number of images to grab</span>
<span class="linenos"> 20</span><span class="n">number_of_images_to_grab</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="c1"># Image scale when displaying using OpenCV.</span>
<span class="linenos"> 23</span><span class="n">DISPLAY_RESIZE_FACTOR</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 26</span>    <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 27</span>    <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>    <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 30</span>    <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>    <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 33</span>    <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">()</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 36</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>    <span class="c1"># Create EdgeEnhancement filter object</span>
<span class="linenos"> 39</span>    <span class="n">st_filter_edge</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_filter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStFilterType</span><span class="o">.</span><span class="n">EdgeEnhancement</span><span class="p">)</span>
<span class="linenos"> 40</span>    <span class="n">st_filter_edge</span><span class="o">.</span><span class="n">strength</span> <span class="o">=</span> <span class="mi">5</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span>    <span class="c1"># Create a converter object for converting pixel format to BGR8.</span>
<span class="linenos"> 43</span>    <span class="n">st_converter_pixelformat</span> <span class="o">=</span> \
<span class="linenos"> 44</span>        <span class="n">st</span><span class="o">.</span><span class="n">create_converter</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">EStConverterType</span><span class="o">.</span><span class="n">PixelFormat</span><span class="p">)</span>
<span class="linenos"> 45</span>    <span class="n">st_converter_pixelformat</span><span class="o">.</span><span class="n">destination_pixel_format</span> <span class="o">=</span> \
<span class="linenos"> 46</span>        <span class="n">st</span><span class="o">.</span><span class="n">EStPixelFormatNamingConvention</span><span class="o">.</span><span class="n">BGR8</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>    <span class="c1"># Create a datastream object for handling image stream data.</span>
<span class="linenos"> 49</span>    <span class="n">st_datastream</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">create_datastream</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="c1"># Start the image acquisition of the host (local machine) side.</span>
<span class="linenos"> 52</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">start_acquisition</span><span class="p">(</span><span class="n">number_of_images_to_grab</span><span class="p">)</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>    <span class="c1"># Start the image acquisition of the camera side.</span>
<span class="linenos"> 55</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_start</span><span class="p">()</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>    <span class="c1"># A while loop for acquiring data and checking status</span>
<span class="linenos"> 58</span>    <span class="k">while</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">is_grabbing</span><span class="p">:</span>
<span class="linenos"> 59</span>        <span class="c1"># Create a localized variable st_buffer using &#39;with&#39;</span>
<span class="linenos"> 60</span>        <span class="c1"># Warning: if st_buffer is in a global scope, st_buffer must be</span>
<span class="linenos"> 61</span>        <span class="c1">#          assign to None to allow Garbage Collector release the buffer</span>
<span class="linenos"> 62</span>        <span class="c1">#          properly.</span>
<span class="linenos"> 63</span>        <span class="k">with</span> <span class="n">st_datastream</span><span class="o">.</span><span class="n">retrieve_buffer</span><span class="p">()</span> <span class="k">as</span> <span class="n">st_buffer</span><span class="p">:</span>
<span class="linenos"> 64</span>            <span class="c1"># Check if the acquired data contains image data.</span>
<span class="linenos"> 65</span>            <span class="k">if</span> <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_image_present</span><span class="p">:</span>
<span class="linenos"> 66</span>                <span class="c1"># Filter and convert the acquired image.</span>
<span class="linenos"> 67</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_filter_edge</span><span class="o">.</span><span class="n">apply_filter</span><span class="p">(</span><span class="n">st_buffer</span><span class="o">.</span><span class="n">get_image</span><span class="p">())</span>
<span class="linenos"> 68</span>                <span class="n">st_image</span> <span class="o">=</span> <span class="n">st_converter_pixelformat</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">st_image</span><span class="p">)</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>                <span class="c1"># Display the information of the acquired image data.</span>
<span class="linenos"> 71</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BlockID=</span><span class="si">{0}</span><span class="s2"> Size=</span><span class="si">{1}</span><span class="s2"> x </span><span class="si">{2}</span><span class="s2"> First Byte=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 72</span>                      <span class="n">st_buffer</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
<span class="linenos"> 73</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
<span class="linenos"> 74</span>                      <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>                <span class="c1"># Get raw image data.</span>
<span class="linenos"> 77</span>                <span class="n">data</span> <span class="o">=</span> <span class="n">st_image</span><span class="o">.</span><span class="n">get_image_data</span><span class="p">()</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>                <span class="c1"># Process image for displaying the BGR8 image.</span>
<span class="linenos"> 82</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">nparr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">st_image</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">st_image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>                <span class="c1"># Resize image.and display.</span>
<span class="linenos"> 85</span>                <span class="n">nparr</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nparr</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 86</span>                                   <span class="n">fx</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">,</span>
<span class="linenos"> 87</span>                                   <span class="n">fy</span><span class="o">=</span><span class="n">DISPLAY_RESIZE_FACTOR</span><span class="p">)</span>
<span class="linenos"> 88</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">nparr</span><span class="p">)</span>
<span class="linenos"> 89</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 90</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 91</span>                <span class="c1"># If the acquired data contains no image data.</span>
<span class="linenos"> 92</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image data does not exist.&quot;</span><span class="p">)</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>    <span class="c1"># Stop the image acquisition of the camera side</span>
<span class="linenos"> 95</span>    <span class="n">st_device</span><span class="o">.</span><span class="n">acquisition_stop</span><span class="p">()</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span>    <span class="c1"># Stop the image acquisition of the host side</span>
<span class="linenos"> 98</span>    <span class="n">st_datastream</span><span class="o">.</span><span class="n">stop_acquisition</span><span class="p">()</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">101</span>    <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-memory-py">
<h3>user_memory.py<a class="headerlink" href="#user-memory-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd"> This sample shows how to use UserMemory function.</span>
<span class="linenos"> 3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos"> 4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos"> 5</span><span class="sd"> - Connect to camera</span>
<span class="linenos"> 6</span><span class="sd"> - How to read user data from the rom and to write user data to the rom.</span>
<span class="linenos"> 7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1"># Feature names</span>
<span class="linenos">12</span><span class="n">DEVICE_USER_MEMORY</span> <span class="o">=</span> <span class="s2">&quot;DeviceUserMemory&quot;</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="k">def</span> <span class="nf">display_register</span><span class="p">(</span><span class="n">register_node</span><span class="p">):</span>
<span class="linenos">15</span>    <span class="n">buffer</span> <span class="o">=</span> <span class="n">register_node</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">16</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">buffer</span><span class="p">):</span>
<span class="linenos">17</span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">18</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:04X}</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">19</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:02X}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">20</span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xF</span><span class="p">:</span>
<span class="linenos">21</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">25</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">26</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos">27</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">28</span>
<span class="linenos">29</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos">30</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos">31</span>
<span class="linenos">32</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos">33</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">(</span>
<span class="linenos">34</span>            <span class="n">st</span><span class="o">.</span><span class="n">ETLDeviceAccessFlags</span><span class="o">.</span><span class="n">AccessExclusive</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos">37</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="c1"># Get the remote nodemap.</span>
<span class="linenos">40</span>        <span class="n">nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="c1"># Use NodeMap object to access current setting of the camera.</span>
<span class="linenos">43</span>        <span class="n">node_user_memory</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">DEVICE_USER_MEMORY</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>        <span class="k">if</span> <span class="n">node_user_memory</span><span class="p">:</span>
<span class="linenos">46</span>            <span class="n">display_register</span><span class="p">(</span><span class="n">node_user_memory</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="linenos">47</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">48</span>            <span class="nb">print</span><span class="p">(</span><span class="n">DEVICE_USER_MEMORY</span> <span class="o">+</span> <span class="s2">&quot; is not supported by this camera.&quot;</span><span class="p">)</span>
<span class="linenos">49</span>
<span class="linenos">50</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">51</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-set-ctrl-py">
<h3>user_set_ctrl.py<a class="headerlink" href="#user-set-ctrl-py" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd"> This sample shows how to use UserSet to load/save setting from/into camera ROM.</span>
<span class="linenos">  3</span><span class="sd"> The following points will be demonstrated in this sample code:</span>
<span class="linenos">  4</span><span class="sd"> - Initialize StApi</span>
<span class="linenos">  5</span><span class="sd"> - Connect to camera</span>
<span class="linenos">  6</span><span class="sd"> - Load/Save UserSet with FeatureBag</span>
<span class="linenos">  7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="kn">import</span> <span class="nn">stapipy</span> <span class="k">as</span> <span class="nn">st</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="c1"># Feature names</span>
<span class="linenos"> 12</span><span class="n">USER_SET_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;UserSetSelector&quot;</span>
<span class="linenos"> 13</span><span class="n">USER_SET_TARGET</span> <span class="o">=</span> <span class="s2">&quot;UserSet1&quot;</span>
<span class="linenos"> 14</span><span class="n">USER_SET_LOAD</span> <span class="o">=</span> <span class="s2">&quot;UserSetLoad&quot;</span>
<span class="linenos"> 15</span><span class="n">USER_SET_SAVE</span> <span class="o">=</span> <span class="s2">&quot;UserSetSave&quot;</span>
<span class="linenos"> 16</span><span class="n">USER_SET_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;UserSetDefault&quot;</span>
<span class="linenos"> 17</span><span class="n">USER_SET_DEFAULT_SELECTOR</span> <span class="o">=</span> <span class="s2">&quot;UserSetDefaultSelector&quot;</span>
<span class="linenos"> 18</span><span class="n">PIXEL_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;PixelFormat&quot;</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="k">def</span> <span class="nf">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">):</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 23</span><span class="sd">    Function to set enumeration value.</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="sd">    :param nodemap: node map.</span>
<span class="linenos"> 26</span><span class="sd">    :param enum_name:  name of the enumeration node.</span>
<span class="linenos"> 27</span><span class="sd">    :param entry_name:  symbolic value of the enumeration entry node.</span>
<span class="linenos"> 28</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 29</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">))</span>
<span class="linenos"> 30</span>    <span class="n">entry_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_node</span><span class="p">[</span><span class="n">entry_name</span><span class="p">])</span>
<span class="linenos"> 31</span>    <span class="c1"># Note that depending on your use case, there are three ways to set</span>
<span class="linenos"> 32</span>    <span class="c1"># the enumeration value:</span>
<span class="linenos"> 33</span>    <span class="c1"># 1) Assign the integer value of the entry with set_int_value(val) or .value</span>
<span class="linenos"> 34</span>    <span class="c1"># 2) Assign the symbolic value of the entry with set_symbolic_value(&quot;val&quot;)</span>
<span class="linenos"> 35</span>    <span class="c1"># 3) Assign the entry (PyIEnumEntry) with set_entry_value(entry)</span>
<span class="linenos"> 36</span>    <span class="c1"># Here set_entry_value is used:</span>
<span class="linenos"> 37</span>    <span class="n">enum_node</span><span class="o">.</span><span class="n">set_entry_value</span><span class="p">(</span><span class="n">entry_node</span><span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="k">def</span> <span class="nf">display_current_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">):</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 42</span><span class="sd">    Display the current setting of the indicated enumeration of the node map.</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="sd">    :param nodemap: node map.</span>
<span class="linenos"> 45</span><span class="sd">    :param enum_name: name of the enumeration node.</span>
<span class="linenos"> 46</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 47</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">))</span>
<span class="linenos"> 48</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 49</span>        <span class="n">enum_name</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_node</span><span class="o">.</span><span class="n">current_entry</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">))</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="k">def</span> <span class="nf">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">enum_name</span><span class="p">):</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 54</span><span class="sd">    Display and allow user to modify the enumeration value.</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="sd">    :param nodemap: node map.</span>
<span class="linenos"> 57</span><span class="sd">    :param enum_name: name of the enumeration node.</span>
<span class="linenos"> 58</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 59</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos"> 60</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_writable</span><span class="p">:</span>
<span class="linenos"> 61</span>        <span class="k">return</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>    <span class="c1"># Get PyIEnumeration from PyNode.</span>
<span class="linenos"> 64</span>    <span class="n">enum_node</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumeration</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 67</span>        <span class="nb">print</span><span class="p">(</span><span class="n">enum_name</span><span class="p">)</span>
<span class="linenos"> 68</span>        <span class="n">enum_entries</span> <span class="o">=</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">entries</span>
<span class="linenos"> 69</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">)):</span>
<span class="linenos"> 70</span>            <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos"> 71</span>            <span class="k">if</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
<span class="linenos"> 72</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> : </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> 
<span class="linenos"> 73</span>                      <span class="n">st</span><span class="o">.</span><span class="n">PyIEnumEntry</span><span class="p">(</span><span class="n">enum_entry</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic_value</span><span class="p">,</span>
<span class="linenos"> 74</span>                      <span class="s2">&quot;(Current)&quot;</span> <span class="k">if</span> <span class="n">enum_node</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 75</span>                                             <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos"> 76</span>        <span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select : &quot;</span><span class="p">))</span>
<span class="linenos"> 77</span>        <span class="k">if</span> <span class="n">selection</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_entries</span><span class="p">):</span>
<span class="linenos"> 78</span>            <span class="n">enum_entry</span> <span class="o">=</span> <span class="n">enum_entries</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
<span class="linenos"> 79</span>            <span class="n">enum_node</span><span class="o">.</span><span class="n">set_int_value</span><span class="p">(</span><span class="n">enum_entry</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="linenos"> 80</span>            <span class="k">break</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 84</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 85</span>        <span class="c1"># Initialize StApi before using.</span>
<span class="linenos"> 86</span>        <span class="n">st</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>        <span class="c1"># Create a system object for device scan and connection.</span>
<span class="linenos"> 89</span>        <span class="n">st_system</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_system</span><span class="p">()</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>        <span class="c1"># Connect to first detected device.</span>
<span class="linenos"> 92</span>        <span class="n">st_device</span> <span class="o">=</span> <span class="n">st_system</span><span class="o">.</span><span class="n">create_first_device</span><span class="p">(</span>
<span class="linenos"> 93</span>            <span class="n">st</span><span class="o">.</span><span class="n">ETLDeviceAccessFlags</span><span class="o">.</span><span class="n">AccessExclusive</span><span class="p">)</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>        <span class="c1"># Display DisplayName of the device.</span>
<span class="linenos"> 96</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Device=&#39;</span><span class="p">,</span> <span class="n">st_device</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>        <span class="c1"># Get the remote nodemap.</span>
<span class="linenos"> 99</span>        <span class="n">nodemap</span> <span class="o">=</span> <span class="n">st_device</span><span class="o">.</span><span class="n">remote_port</span><span class="o">.</span><span class="n">nodemap</span>
<span class="linenos">100</span>
<span class="linenos">101</span>        <span class="c1"># Set the UserSet to be used by UserSetSelector.</span>
<span class="linenos">102</span>        <span class="n">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">USER_SET_SELECTOR</span><span class="p">,</span> <span class="n">USER_SET_TARGET</span><span class="p">)</span>
<span class="linenos">103</span>
<span class="linenos">104</span>        <span class="c1"># Load the UserSet stored in the ROM to the camera.</span>
<span class="linenos">105</span>        <span class="c1"># Here, .get() is used to automatically cast the PyNode to PyICommand.</span>
<span class="linenos">106</span>        <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">USER_SET_LOAD</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">107</span>
<span class="linenos">108</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded :&quot;</span><span class="p">,</span> <span class="n">USER_SET_TARGET</span><span class="p">)</span>
<span class="linenos">109</span>
<span class="linenos">110</span>        <span class="c1"># Create a FeatureBag object for acquiring/saving camera settings.</span>
<span class="linenos">111</span>        <span class="n">featurebag</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">create_featurebag</span><span class="p">()</span>
<span class="linenos">112</span>
<span class="linenos">113</span>        <span class="c1"># Save the current settings to FeatureBag.</span>
<span class="linenos">114</span>        <span class="n">featurebag</span><span class="o">.</span><span class="n">store_nodemap_to_bag</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">115</span>
<span class="linenos">116</span>        <span class="c1"># Set the pixel format.</span>
<span class="linenos">117</span>        <span class="n">edit_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">PIXEL_FORMAT</span><span class="p">)</span>
<span class="linenos">118</span>
<span class="linenos">119</span>        <span class="c1"># Display current pixel format setting.</span>
<span class="linenos">120</span>        <span class="n">display_current_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">PIXEL_FORMAT</span><span class="p">)</span>
<span class="linenos">121</span>
<span class="linenos">122</span>        <span class="c1"># Load the UserSet that are stored in the ROM to the camera.</span>
<span class="linenos">123</span>        <span class="c1"># Here, .get() is used to automatically cast the PyNode to PyICommand.</span>
<span class="linenos">124</span>        <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">USER_SET_LOAD</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">125</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded :&quot;</span><span class="p">,</span> <span class="n">USER_SET_TARGET</span><span class="p">)</span>
<span class="linenos">126</span>
<span class="linenos">127</span>        <span class="c1"># Display current pixel format setting.</span>
<span class="linenos">128</span>        <span class="n">display_current_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">PIXEL_FORMAT</span><span class="p">)</span>
<span class="linenos">129</span>
<span class="linenos">130</span>        <span class="c1"># Load the settings in the FeatureBag to the camera.</span>
<span class="linenos">131</span>        <span class="n">featurebag</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nodemap</span><span class="p">)</span>
<span class="linenos">132</span>
<span class="linenos">133</span>        <span class="c1"># Set the UserSet for UserSetSelector.</span>
<span class="linenos">134</span>        <span class="n">set_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">USER_SET_SELECTOR</span><span class="p">,</span> <span class="n">USER_SET_TARGET</span><span class="p">)</span>
<span class="linenos">135</span>
<span class="linenos">136</span>        <span class="c1"># Save the current settings to UserSet.</span>
<span class="linenos">137</span>        <span class="c1"># Here, .get() is used to automatically cast the PyNode to PyICommand.</span>
<span class="linenos">138</span>        <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">USER_SET_SAVE</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">139</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved :&quot;</span><span class="p">,</span> <span class="n">USER_SET_TARGET</span><span class="p">)</span>
<span class="linenos">140</span>
<span class="linenos">141</span>        <span class="k">if</span> <span class="n">nodemap</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">USER_SET_DEFAULT</span><span class="p">):</span>
<span class="linenos">142</span>            <span class="n">display_current_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">USER_SET_DEFAULT</span><span class="p">)</span>
<span class="linenos">143</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">144</span>            <span class="n">display_current_enumeration</span><span class="p">(</span><span class="n">nodemap</span><span class="p">,</span> <span class="n">USER_SET_DEFAULT_SELECTOR</span><span class="p">)</span>
<span class="linenos">145</span>
<span class="linenos">146</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
<span class="linenos">147</span>        <span class="nb">print</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">サンプルプログラム</a><ul>
<li><a class="reference internal" href="#list-of-samples">サンプル一覧</a></li>
<li><a class="reference internal" href="#source-codes">ソースコード</a><ul>
<li><a class="reference internal" href="#auto-functions-opencv-py">auto_functions_opencv.py</a></li>
<li><a class="reference internal" href="#camera-side-roi-py">camera_side_roi.py</a></li>
<li><a class="reference internal" href="#event-device-lost-py">event_device_lost.py</a></li>
<li><a class="reference internal" href="#featurelist-py">featurelist.py</a></li>
<li><a class="reference internal" href="#framestart-trigger-py">framestart_trigger.py</a></li>
<li><a class="reference internal" href="#gige-action-command-py">gige_action_command.py</a></li>
<li><a class="reference internal" href="#gige-configurations-py">gige_configurations.py</a></li>
<li><a class="reference internal" href="#gige-multicast-py">gige_multicast.py</a></li>
<li><a class="reference internal" href="#grab-callback-class-py">grab_callback_class.py</a></li>
<li><a class="reference internal" href="#grab-callback-opencv-py">grab_callback_opencv.py</a></li>
<li><a class="reference internal" href="#grab-callback-py">grab_callback.py</a></li>
<li><a class="reference internal" href="#grab-camera-event-py">grab_camera_event.py</a></li>
<li><a class="reference internal" href="#grab-chunk-image-py">grab_chunk_image.py</a></li>
<li><a class="reference internal" href="#grab-ip-opencv-py">grab_ip_opencv.py</a></li>
<li><a class="reference internal" href="#grab-opencv-py">grab_opencv.py</a></li>
<li><a class="reference internal" href="#grab-py">grab.py</a></li>
<li><a class="reference internal" href="#host-side-roi-opencv-py">host_side_roi_opencv.py</a></li>
<li><a class="reference internal" href="#multiple-cameras-py">multiple_cameras.py</a></li>
<li><a class="reference internal" href="#multiple-systems-py">multiple_systems.py</a></li>
<li><a class="reference internal" href="#save-and-load-image-py">save_and_load_image.py</a></li>
<li><a class="reference internal" href="#save-load-features-py">save_load_features.py</a></li>
<li><a class="reference internal" href="#save-video-py">save_video.py</a></li>
<li><a class="reference internal" href="#singleconverter-opencv-py">singleconverter_opencv.py</a></li>
<li><a class="reference internal" href="#singlefilter-opencv-py">singlefilter_opencv.py</a></li>
<li><a class="reference internal" href="#user-memory-py">user_memory.py</a></li>
<li><a class="reference internal" href="#user-set-ctrl-py">user_set_ctrl.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="programmersguide.html"
                          title="前の章へ">プログラマーズガイド</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="reference.html"
                          title="次の章へ">StApi Python(stapipy)リファレンス</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="reference.html" title="StApi Python(stapipy)リファレンス"
             >次へ</a> |</li>
        <li class="right" >
          <a href="programmersguide.html" title="プログラマーズガイド"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">StApi Python 1.2.2 ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">サンプルプログラム</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019-2024, Omron Sentech Co., Ltd..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>